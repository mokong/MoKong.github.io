<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>iOS CreateML的使用 | 今是昨非的博客</title><meta name="author" content="今是昨非"><meta name="copyright" content="今是昨非"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CreateML使用背景业务需求，想要通过拍照识别照片中指定物体的数量或者物体的种类。而这种物体的模型网上没有训练好的，需要从头开始。所以调研了苹果的createML的实现方案，具体操作如下：">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS CreateML的使用">
<meta property="og:url" content="http://morganwang.cn/2022/09/28/CreateML%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="今是昨非的博客">
<meta property="og:description" content="CreateML使用背景业务需求，想要通过拍照识别照片中指定物体的数量或者物体的种类。而这种物体的模型网上没有训练好的，需要从头开始。所以调研了苹果的createML的实现方案，具体操作如下：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://morganwang.cn/assets/img/avatar.jpeg">
<meta property="article:published_time" content="2022-09-28T05:25:00.000Z">
<meta property="article:modified_time" content="2024-01-22T11:04:42.000Z">
<meta property="article:author" content="今是昨非">
<meta property="article:tag" content="技术">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://morganwang.cn/assets/img/avatar.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "iOS CreateML的使用",
  "url": "http://morganwang.cn/2022/09/28/CreateML%E4%BD%BF%E7%94%A8/",
  "image": "http://morganwang.cn/assets/img/avatar.jpeg",
  "datePublished": "2022-09-28T05:25:00.000Z",
  "dateModified": "2024-01-22T11:04:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "今是昨非",
      "url": "http://morganwang.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://morganwang.cn/2022/09/28/CreateML%E4%BD%BF%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'iOS CreateML的使用',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">190</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">今是昨非的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">iOS CreateML的使用</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">iOS CreateML的使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-28T05:25:00.000Z" title="发表于 2022-09-28 13:25:00">2022-09-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T11:04:42.000Z" title="更新于 2024-01-22 19:04:42">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="CreateML使用"><a href="#CreateML使用" class="headerlink" title="CreateML使用"></a>CreateML使用</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>业务需求，想要通过拍照识别照片中指定物体的数量或者物体的种类。而这种物体的模型网上没有训练好的，需要从头开始。所以调研了苹果的createML的实现方案，具体操作如下：</p>
<span id="more"></span>

<p>需求是：<strong>通过拍照识别照片中指定物体的数量</strong>，实现方案大致有几种：</p>
<ul>
<li>通过第三方平台，训练数据，生成模型，提供前端使用</li>
<li>自己搭建平台，训练数据，生成模型，提供前端使用</li>
<li>通过苹果的CreateML工具，训练数据，生成模型，供iOS使用或转换成其他模型使用</li>
</ul>
<p>对比可以发现，通过苹果的CreateML工具，可以省去搭建平台的过程。下面来看看怎么使用CreateML。</p>
<p>使用CreateML的整体流程是：</p>
<ol>
<li>有大量的样本</li>
<li>标注所有的样本</li>
<li>用这些样本训练生成模型</li>
<li>验证模型的识别率</li>
<li>测试模型效果</li>
<li>导出模型供使用</li>
</ol>
<img src="https://docs-assets.developer.apple.com/published/eb03080ad7cc9d6f88eadc90b3bac920/create-ml-1@2x.png" width="50%">

<p>需求是<strong>通过拍照识别照片中指定物体的数量</strong>，所以对我来说样本就是照片，下面就来看下怎么生成CreateML训练需求的标注信息。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="样本照片标注"><a href="#样本照片标注" class="headerlink" title="样本照片标注"></a>样本照片标注</h3><p>首先要有大量的样本照片，这里由于是调研测试，所以选取20张照片，照片来源是百度图片。。。麻烦的是照片标注，由于苹果CreateML训练需要指定格式的<code>JSON</code>文件，格式如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;图片名字.jpg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;annotations&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;label&quot;</span>: <span class="string">&quot;标签名字&quot;</span>,</span><br><span class="line">                <span class="string">&quot;coordinates&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;x&quot;</span>: <span class="number">133</span>,</span><br><span class="line">                    <span class="string">&quot;y&quot;</span>: <span class="number">240.5</span>,</span><br><span class="line">                    <span class="string">&quot;width&quot;</span>: <span class="number">113.5</span>,</span><br><span class="line">                    <span class="string">&quot;height&quot;</span>: <span class="number">185</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"> ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所以找一个能直接导出<code>Create ML</code>支持的<code>JSON</code>格式的标注工具尤其重要。这里参考<a target="_blank" rel="noopener" href="https://evilmartians.com/chronicles/object-detection-with-create-ml-images-and-dataset">Object Detection with Create ML: images and dataset</a>使用<a target="_blank" rel="noopener" href="https://app.roboflow.com/">roboflow</a>来进行标注，具体使用如下：</p>
<p><a target="_blank" rel="noopener" href="https://app.roboflow.com/">roboflow</a>登陆后，会有引导步骤，建立workSpace，workSpace下新建项目，也可以邀请用户加入到同一个workSpace，界面如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929101430.png" width="70%">

<p>点击<code>Create Project</code>，需要输入项目的名字，选择项目的<code>License</code>，选择项目的功能，输入要标记的物体的名字，界面如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929102425.png" width="50%">


<p>然后导入照片，比如去网上下载十几张钢管的照片，训练识别钢管（通常应该是很多很多照片，样本越多，训练出的模型就越准确这里只用于演示流程，所以选取的照片不多）；注意照片上传完成后，不要点击右上角的<code>Finish Uploading</code>，因为此时还没有标注，注意<code>All Images(18)</code>，<code>Annotated(0)</code>，说明没有一张标注的。</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929134102.png" width="70%">

<p>双击任意一张照片，即可进入标注页面，</p>
<ol>
<li>在标注页面，要先选择最右侧标注工具，默认是长方形框框标注；</li>
<li>然后选择标注的范围，注意的是使用曲线标注时，起始和结束的两个点要闭合；</li>
<li>然后在弹出的Annotation Editor框中，输入要标记的label，然后点击保存；</li>
<li>如果有多个标记，则重复上面的过程；</li>
<li>所有标记都完成后，点击左侧的返回即可；</li>
</ol>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929134732.png" width="70%">

<p>所有照片都标记好之后，点击Finish Uploading，会弹出如下提示框，选择如何分配照片给<code>Train</code>、<code>Valid</code>和<code>Test</code>，默认是所有照片都用于<code>Train</code>，如下：</p>
<figure>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929135517.png" width="50%">
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929135548.png" width="50%">
</figure>

<p>点击Continue，进入下一步。可以看到步骤1和2都已完成，如果想要编辑上面两个步骤，也可以移动鼠标到对应模块的右半边，会出现编辑按钮；目前所在步骤3，<code>Auto-Orient</code>意思是<code>Discard EXIF rotations and standardize pixel ordering.</code>，如果不需要可以删除这步；<code>Resize</code>是把照片重新调整大小。也可以添加<code>Preprosession Step</code>。这个步骤的预处理的目的是用于节省最终训练时间。</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929140548.png" width="70%">

<p>点击Continue，进入步骤4，这个步骤的目的是通过生成训练集中每个图像的增强版本，为模型创建新的训练示例以进行学习。如果不需要，可以直接点击Continue，进入下一步。</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929141234.png" width="70%">

<p>最后一步，就是生成结果，点击Generate，然后等待结果出现。结果如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929141659.png" width="70%">

<p>从上图可以看到，所有标注的照片、<code>Train</code>和<code>Validation</code>和<code>Test</code>的数量，<code>Start Training</code>按钮是网站提供的在线训练功能，这里用不到；需要的是导出CreateML类型的标注信息，所以点击<code>Export</code>，在弹出的弹窗中选择要导出的格式，这个网站最好用的就是导出支持的格式很多，这里选择<code>CreateML</code>，然后选中<code>download zip to computer</code>，点击Continue。</p>
<figure>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929142127.png" width="40%">
<img src="![](https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929142223.png)" witdh="40%">
</figure>

<p>在finder中找到下载的<code>xxx.createml.zip</code>，解压，查看文件夹，内容如下，可以看到<code>Train</code>、<code>Valid</code>、<code>Test</code>都已分类好，查看<code>Train</code>文件夹下<code>_annotations.createml.json</code>，可以看到格式和<code>CreateML</code>需要的一致，可以直接使用。</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929142634.png" width="40%">

<h3 id="CreateML使用-1"><a href="#CreateML使用-1" class="headerlink" title="CreateML使用"></a>CreateML使用</h3><p>选择Xcode -&gt; Open Developer Tool -&gt; Create ML，打开CreateML工具，如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929144839.png" width="70%">

<p>然后进入选择项目界面，如果已有CreateML项目，则选择打开；没有则选择要保存的文件夹，然后点击左下角的<code>New Document</code>进入创建页面，创建页面如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929145231.png" width="70%">

<p>根据需要，选择要创建的模板，这里选择<code>Object Detection</code>，然后输入项目名字和描述，如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929150036.png" width="70%">

<blockquote>
<p>这里歪个楼，看到<code>Text Classification</code>和<code>Word Tagging</code>，想起来商店里的短信过滤APP，可能就是用大量的垃圾短信，然后通过CreateML训练出模型，再导入到项目中，在项目中继续用Core ML来不断更新这个模型，从而针对每个人做到识别效果更好。</p>
</blockquote>
<p>点击下一步，进入主界面，如下图所示，可以看到有以下几部分：</p>
<ul>
<li>上方中间的<code>Setting</code>、<code>Traning</code>、<code>Evaluation</code>、<code>Preview</code>、<code>Output</code>代表CreateML的几个步骤，可以切换查看，目前后面个步骤都是空的，因为还没有训练的结果。</li>
<li>上方左侧的<code>Train</code>按钮是在中间部分<code>TrainingData</code>选择导入数据后，开始训练。</li>
<li>Data部分分别可以用刚刚下载的文件夹中的内容，但是首先要导入<code>Train</code>的文件，并且等训练结果出来后，可以继续后面的步骤。</li>
<li>Parameters部分<ul>
<li>Algorithm是选择算法，默认的<code>FullNetworking</code>是基于YOLOv2的，可以选择<code>TransferLearning</code>，<code>TransferLearning</code>与样本数量相关，训练出的模型也更小。至于什么是YOLOv2，可以参考这篇文章<a target="_blank" rel="noopener" href="https://machinelearningmastery.com/object-recognition-with-deep-learning/">A Gentle Introduction to Object Recognition With Deep Learning</a>，看完会对深度学习的几种算法有大致的理解</li>
<li><code>Iterations</code>训练的迭代次数，并不是越大越好，也不能太小。</li>
<li><code>Batch Size</code>，每次迭代训练的数据大小，值越大占用的内存越大。参考<a target="_blank" rel="noopener" href="https://stats.stackexchange.com/questions/153531/what-is-batch-size-in-neural-network">What is batch size in neural network?</a></li>
<li><code>Grid Size</code>，参考<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/createml/mlobjectdetector/modelparameters-swift.struct/gridsize">gridsize</a>，YOLO算法中分割图片为多少块。</li>
</ul>
</li>
</ul>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929151517.png" width="70%">


<p>这里设置Iterations为100，其余采用默认设置，然后点击<code>Train</code>，会进入<code>Training</code>的步骤，最终结果如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929163803.png" width="70%">

<p>然后选择<code>Testing Data</code>，由于下载的标注中<code>Test</code>只有两条数据，所以可以接着用<code>Train</code>来作为<code>Testing Data</code>的数据，点击<code>Test</code>，然后等待结果出现，如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929164219.png" width="70%">

<p>这个页面上的<code>I/U  50%</code>和<code>Varied I/U</code>的意义可参考<a target="_blank" rel="noopener" href="https://developer.apple.com/forums/thread/666749">CreateML object detection evaluation</a></p>
<blockquote>
<p>I/U means “Intersection over Union”. It is a very simple metric which tells you how good the model is at predicting a bounding box of an object. You can read more about I/U in the “Intersection over Union (IoU) for object detection” article at PyImageSearch.<br>So:<br> I/U 50% means how many observations have their I/U score over 50%<br> Varied I/U is an average I/U score for a data set</p>
</blockquote>
<p>也可以通过Preview更直观的查看识别效果，如下，点击添加文件，选择所有钢管照片</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929170504.png" width="70%">

<p>然后一张张查看，就可以看到每张能不能识别出</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929170953.png" width="70%">

<p>最后，切到Output，点击Get，导出模型<code>xxx.mlmodel</code>，如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929171202.png" width="70%">

<h3 id="训练出的模型mlmodel的使用"><a href="#训练出的模型mlmodel的使用" class="headerlink" title="训练出的模型mlmodel的使用"></a>训练出的模型mlmodel的使用</h3><p>新建一个项目，把训练出的模型导入到项目中，如下：</p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/20220929172419.png" width="30%">

<p>然后导入<code>Vision</code>库，加载一张照片，然后生成<code>VNImageRequestHandler</code>，用生成的handler去识别，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PipeImageDetectorVC</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - properties</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> coreMLRequest: <span class="type">VNCoreMLRequest</span>?</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> drawingBoxesView: <span class="type">DrawingBoxesView</span>?</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> displayImageView: <span class="type">UIImageView</span> <span class="operator">=</span> <span class="type">UIImageView</span>()</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> randomLoadBtn: <span class="type">UIButton</span> <span class="operator">=</span> <span class="type">UIButton</span>(type: .custom)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - view life cycle</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        setupDisplayImageView()</span><br><span class="line">        setupCoreMLRequest()</span><br><span class="line">        setupBoxesView()</span><br><span class="line">        setupRandomLoadBtn()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span>(<span class="keyword">_</span> <span class="params">animated</span>: <span class="type">Bool</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - init</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">setupDisplayImageView</span>()</span> &#123;</span><br><span class="line">        view.addSubview(displayImageView)</span><br><span class="line">        displayImageView.contentMode <span class="operator">=</span> .scaleAspectFit</span><br><span class="line">        displayImageView.snp.makeConstraints &#123; make <span class="keyword">in</span></span><br><span class="line">            make.center.equalTo(view.snp.center)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">setupCoreMLRequest</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> model <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">PipeObjectDetector</span>(configuration: <span class="type">MLModelConfiguration</span>()).model,</span><br><span class="line">              <span class="keyword">let</span> visionModel <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">VNCoreMLModel</span>(for: model) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        coreMLRequest <span class="operator">=</span> <span class="type">VNCoreMLRequest</span>(model: visionModel, completionHandler: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (request, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.handleVMRequestDidComplete(request, error: error)</span><br><span class="line">        &#125;)</span><br><span class="line">        coreMLRequest<span class="operator">?</span>.imageCropAndScaleOption <span class="operator">=</span> .centerCrop</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">setupBoxesView</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> drawingBoxesView <span class="operator">=</span> <span class="type">DrawingBoxesView</span>()</span><br><span class="line">        drawingBoxesView.frame <span class="operator">=</span> displayImageView.frame</span><br><span class="line">        displayImageView.addSubview(drawingBoxesView)</span><br><span class="line">        drawingBoxesView.snp.makeConstraints &#123; make <span class="keyword">in</span></span><br><span class="line">            make.edges.equalToSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.drawingBoxesView <span class="operator">=</span> drawingBoxesView</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">setupRandomLoadBtn</span>()</span> &#123;</span><br><span class="line">        randomLoadBtn.setTitle(<span class="string">&quot;随机加载一张图片&quot;</span>, for: .normal)</span><br><span class="line">        randomLoadBtn.setTitleColor(<span class="type">UIColor</span>.blue, for: .normal)</span><br><span class="line">        view.addSubview(randomLoadBtn)</span><br><span class="line">        <span class="keyword">let</span> screenW <span class="operator">=</span> <span class="type">UIScreen</span>.main.bounds.width</span><br><span class="line">        <span class="keyword">let</span> screeH <span class="operator">=</span> <span class="type">UIScreen</span>.main.bounds.height</span><br><span class="line">        <span class="keyword">let</span> btnH <span class="operator">=</span> <span class="number">52.0</span></span><br><span class="line">        <span class="keyword">let</span> btnW <span class="operator">=</span> <span class="number">200.0</span></span><br><span class="line">        randomLoadBtn.frame <span class="operator">=</span> <span class="type">CGRect</span>(x: (screenW <span class="operator">-</span> btnW) <span class="operator">/</span> <span class="number">2.0</span>, y: screeH <span class="operator">-</span> btnH <span class="operator">-</span> <span class="number">10.0</span>, width: btnW, height: btnH)</span><br><span class="line">        </span><br><span class="line">        randomLoadBtn.addTarget(<span class="keyword">self</span>, action: #selector(handleRandomLoad), for: .touchUpInside)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - utils</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - action</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">handleVMRequestDidComplete</span>(<span class="keyword">_</span> <span class="params">request</span>: <span class="type">VNRequest</span>, <span class="params">error</span>: <span class="type">Error</span>?)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> results <span class="operator">=</span> request.results <span class="keyword">as?</span> [<span class="type">VNRecognizedObjectObservation</span>]</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> prediction <span class="operator">=</span> results<span class="operator">?</span>.first &#123;</span><br><span class="line">                <span class="keyword">self</span>.drawingBoxesView<span class="operator">?</span>.drawBox(with: [prediction])</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.drawingBoxesView<span class="operator">?</span>.removeBox()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">handleRandomLoad</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> imageName <span class="operator">=</span> randomImageName()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> image <span class="operator">=</span> <span class="type">UIImage</span>(named: imageName),</span><br><span class="line">            <span class="keyword">let</span> cgImage <span class="operator">=</span> image.cgImage,</span><br><span class="line">            <span class="keyword">let</span> request <span class="operator">=</span> coreMLRequest &#123;</span><br><span class="line">            displayImageView.image <span class="operator">=</span> image</span><br><span class="line">            <span class="keyword">let</span> handler <span class="operator">=</span> <span class="type">VNImageRequestHandler</span>(cgImage: cgImage)</span><br><span class="line">            <span class="keyword">try?</span> handler.perform([request])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - other</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">randomImageName</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> maxNum: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">18</span></span><br><span class="line">        <span class="keyword">let</span> minNum: <span class="type">UInt32</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">let</span> randomNum <span class="operator">=</span> arc4random_uniform(maxNum <span class="operator">-</span> minNum) <span class="operator">+</span> minNum</span><br><span class="line">        <span class="keyword">let</span> imageName <span class="operator">=</span> <span class="string">&quot;images-<span class="subst">\(randomNum)</span>.jpeg&quot;</span></span><br><span class="line">        <span class="keyword">return</span> imageName</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终效果如下，完整代码已放在Github: <a target="_blank" rel="noopener" href="https://github.com/mokong/CreateMLDemo">CreateMLDemo</a></p>
<img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/ezgif-4-c541b3889a.gif" width="50%">

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本篇介绍了<code>CreateML</code>的整体流程，从模型标注 ，到训练生成模型，再到使用模型，希望大家能对<code>CreateML</code>有大致的了解。后面再来研究下，已导入项目中的模型，能否更新，如何更新？以及尝试做自己的短信过滤APP。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/machine-learning/create-ml/">Create ML</a></li>
<li><a target="_blank" rel="noopener" href="https://www.createwithswift.com/creating-an-object-detection-machine-learning-model-with-create-ml/">Creating an Object Detection Machine Learning Model with Create ML</a></li>
<li><a target="_blank" rel="noopener" href="https://evilmartians.com/chronicles/object-detection-with-create-ml-images-and-dataset">Object Detection with Create ML: images and dataset</a></li>
<li><a target="_blank" rel="noopener" href="https://evilmartians.com/chronicles/object-detection-with-create-ml-training-and-demo-app">Object Detection with Create ML: training and demo app</a></li>
<li><a target="_blank" rel="noopener" href="https://machinethink.net/blog/coreml-training-part1/">On-device training with Core ML – part 1</a></li>
<li><a target="_blank" rel="noopener" href="https://www.createwithswift.com/core-ml-explained-apples-machine-learning-framework/">Core ML Explained: Apple’s Machine Learning Framework</a></li>
<li><a target="_blank" rel="noopener" href="https://machinelearningmastery.com/object-recognition-with-deep-learning/">A Gentle Introduction to Object Recognition With Deep Learning</a></li>
<li><a target="_blank" rel="noopener" href="https://apple.github.io/turicreate/docs/userguide/">Turi Create</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://morganwang.cn">今是昨非</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://morganwang.cn/2022/09/28/CreateML%E4%BD%BF%E7%94%A8/">http://morganwang.cn/2022/09/28/CreateML%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://morganwang.cn" target="_blank">今是昨非的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF/">技术</a><a class="post-meta__tags" href="/tags/iOS/">iOS</a></div><div class="post-share"><div class="social-share" data-image="/assets/img/avatar.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/10/11/Xcode%2014%E7%BC%96%E8%AF%91%E7%9A%84APP%E4%BD%8E%E7%89%88%E6%9C%AC%E5%B4%A9%E6%BA%83/" title="Xcode14编译的APP低版本崩溃"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Xcode14编译的APP低版本崩溃</div></div><div class="info-2"><div class="info-item-1">背景测试说iOS 12的手机上安装Xcode14.0.2导出的新包后，打开就崩溃，但是在系统版本高的手机上就没有问题。   调试后发现，崩溃日志是dyld: Library not loaded: /usr/lib/swift/libswiftCoreGraphics.dylib，具体如下：  dyld: Library not loaded: /usr/lib/swift/libswiftCoreGraphics.dylib  Referenced from: /private/var/containers/Bundle/Application/55730273-D9D6-4C42-9335-7A56F92B7F2C/xxx.app/Frameworks/FSPagerView.framework/FSPagerView  Reason: image not founds  搜索后发现，开发者社区中有此问题的记录，xcode14:Library not loaded: /usr/lib/swift/libswiftCoreGraphics.dylib，解决方案是：  If yo...</div></div></div></a><a class="pagination-related" href="/2022/09/27/Xcode14%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AEPodInit%E5%A4%B1%E8%B4%A5/" title="Xcode 14新建项目 Pod init失败"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Xcode 14新建项目 Pod init失败</div></div><div class="info-2"><div class="info-item-1">Xcode 14新建项目 Pod init失败背景使用Xcode 14.0(14A309)新建了一个项目，然后运行Pod init，就报错，[Xcodeproj] Unknown object version (56). (RuntimeError)和can&#39;t modify frozen String (FrozenError)。    排查一开始看报错以为是cocoapods出问题了，最坏的打算是重装CocoaPods，但是先去搜索一下，看是否是其他原因导致的，或者有没有遇到同样错误的。 搜索can&#39;t modify frozen String (FrozenError)，搜出来都是m1芯片怎么怎么的，但是我的电脑不是m1芯片的，所以不是这个问题。 搜can&#39;t modify frozen String (FrozenError)，发现了pod init cause RuntimeError - [Xcodeproj] Unknown object version 和 RuntimeError - [Xcodeproj] Unknown object ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2019/09/08/CocoaPods%E7%A7%81%E6%9C%89%E5%BA%93%E7%94%9F%E6%88%90/" title="CocoaPods私有库生成"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-08</div><div class="info-item-2">CocoaPods私有库生成</div></div><div class="info-2"><div class="info-item-1">CocoaPods私有库生成</div></div></div></a><a class="pagination-related" href="/2024/03/13/Xcode%2015.3%20Archive%E5%A4%B1%E8%B4%A5/" title="Xcode 15.3 Archive失败"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-13</div><div class="info-item-2">Xcode 15.3 Archive失败</div></div><div class="info-2"><div class="info-item-1">Xcode 15.3 Archive失败背景昨晚升级 Xcode 到 15.3，今天打包的时候发现 Archive 失败，提示：Call parameter type does not match function signature!，仔细看报错里是和HandyJSON相关的提示。   解决起初以为和 Pod 库有关系，但是找同事确认后，发现低于 Xcode 15.3 的版本是可以打包成功的，但是 Xcode 15.3 的版本就报错了。然后搜索HandyJSON Call parameter type does not match function signature!，发现了这个，Building HandyJSON in Swift 5.10 throws a fatal error ，是Swift 5.10 编译 HandyJSON报错了。目前HandyJSON官方还未解决。 暂时的解决方法是： 在 Pod 的 Target 中找到 HandyJSON, 然后设置Optimization Level为 None和No Optimization，如下图：  然后再次尝试 A...</div></div></div></a><a class="pagination-related" href="/2025/08/20/Xcode26%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%E4%BF%AE%E6%94%B9/" title="Xcode 26编译失败修改"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="info-item-2">Xcode 26编译失败修改</div></div><div class="info-2"><div class="info-item-1">背景电脑升级MacOS 26.0，新增了一个SDK后，Xcode26 Beta5和Beta6，编译项都报错，提示：Assertion failed: (it != _dylibToOrdinal.end()), function dylibToOrdinal, file OutputFile.cpp, line 5196.   排查过程 在StackOverFlow上有看到说ENABLE_DEBUG_DYLIB=NO，尝试后无效果 在Xcode 26 Link Error中看到，Apple官方人员的回复，要添加-Xlinker -dead_strip -Xlinker -allow_dead_duplicates.  解决办法通过 Other Linker Flags 修改进入 Target 的 Build Settings 标签：选中 Target → Build Settings → 搜索 Other Linker Flags。手动修改链接参数：点击 Other Linker Flags，首先移除 12-ld64 -ld_classic  然后添加 1234-Xlinker ...</div></div></div></a><a class="pagination-related" href="/2020/08/10/iOS%2014%20beta4%E5%B4%A9%E6%BA%83%E4%BF%AE%E6%94%B9/" title="iOS beta4崩溃修改"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-10</div><div class="info-item-2">iOS beta4崩溃修改</div></div><div class="info-2"><div class="info-item-1">iOS beta4崩溃修改前言升级iOSBeta4后，有用户反馈使用我们APP时会崩溃，有登录的、查看详情的，都会出现崩溃。我们查看Bugly数据也发现崩溃率上升了0.02%，直接超出了指定的崩溃指标。虽然是由于升级beta版系统导致的，但还是要排查出具体原因，然后尽快适配。所以我说一下我发现的哪个API导致的，供大家参考一下。   排查由于崩溃是必现的，所以排查起来很容易，找一台升级了iOS14 beta4的手机，然后复现步骤，看具体崩溃的地方，即可我们APP是由于使用了SexyJson这个库，其中SexyJsonProtocol这个类第67行中sexyToValue()的方法里使用AnyRandomAccessCollection这个地方有强制解包属性，在之前的系统版本中，这个地方返回的值不为空，所以没有问题，但是在这个版本里，这个属性返回为空了，就导致了新系统中的崩溃。 如图所示位置： 修改由于是强制解包导致的，所以直接的修改就是，把这个地方的强制解包，改为if let的格式，修改后，运行，binggo，崩溃确实没了。但是在验证过程中，由于我们使用这个是把请求的对象转为参数...</div></div></div></a><a class="pagination-related" href="/2024/03/16/Pod%20%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E7%9B%B8%E4%BA%92%E5%BC%95%E7%94%A8/" title="Pod 私有库相互引用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-16</div><div class="info-item-2">Pod 私有库相互引用</div></div><div class="info-2"><div class="info-item-1">私有库的相互引用文章是转载自OC和Swift混合开发(Pod私有库的相互引用)，在这里记录一下，方便以后查看。   概述：该文档主要介绍OC和Swift混合开发相互调用，包括3大类情况和12种具体情形。 三大类情况：  主工程内的混合互调，  主工程和Pod三方库之间的混合互调，  Pod三方库和其他Pod三方库之间的混合互调。   十二种情形：  主工程内的OC 调用 主工程内的OC：#import “NSObject.h”   导入头文件直接调用。   主工程内的OC 调用 主工程内的Swift：   1. 主工程中创建.pch文件，在TARGETS -&gt; Build Setting -&gt; 搜索pch -&gt; 设置.pch文件的路径，     2. 在.pch文件中添加 ：       例如：#import “xxxxx_Swift.h”        (该文件命名规则为：”工程名_Swift.h”，该文件为系统自动生成) ，    3. 编译之后才可自动识别需要调用的Swift的文件 。  主工程内的OC 调用 OC的Pod三方库：     #import ...</div></div></div></a><a class="pagination-related" href="/2022/09/27/Xcode14%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AEPodInit%E5%A4%B1%E8%B4%A5/" title="Xcode 14新建项目 Pod init失败"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-27</div><div class="info-item-2">Xcode 14新建项目 Pod init失败</div></div><div class="info-2"><div class="info-item-1">Xcode 14新建项目 Pod init失败背景使用Xcode 14.0(14A309)新建了一个项目，然后运行Pod init，就报错，[Xcodeproj] Unknown object version (56). (RuntimeError)和can&#39;t modify frozen String (FrozenError)。    排查一开始看报错以为是cocoapods出问题了，最坏的打算是重装CocoaPods，但是先去搜索一下，看是否是其他原因导致的，或者有没有遇到同样错误的。 搜索can&#39;t modify frozen String (FrozenError)，搜出来都是m1芯片怎么怎么的，但是我的电脑不是m1芯片的，所以不是这个问题。 搜can&#39;t modify frozen String (FrozenError)，发现了pod init cause RuntimeError - [Xcodeproj] Unknown object version 和 RuntimeError - [Xcodeproj] Unknown object ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">今是昨非</div><div class="author-info-description">技术分享、生活感悟</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">190</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mokong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/mokong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://x.com/morgan2015_wang" target="_blank" title="Twitter"><i class="fab fa-X"></i></a><a class="social-icon" href="mailto:mokong.2015.1992@email.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CreateML%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">CreateML使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E6%9C%AC%E7%85%A7%E7%89%87%E6%A0%87%E6%B3%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">样本照片标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CreateML%E4%BD%BF%E7%94%A8-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">CreateML使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E5%87%BA%E7%9A%84%E6%A8%A1%E5%9E%8Bmlmodel%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.3.</span> <span class="toc-text">训练出的模型mlmodel的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.4.</span> <span class="toc-text">参考</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/27/CodeBuddyCN%20%E4%BD%BF%E7%94%A8%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%83%E7%89%9B%20Model%20%E6%AD%A5%E9%AA%A4/" title="CodeBuddyCN 使用免费的七牛 Model 步骤">CodeBuddyCN 使用免费的七牛 Model 步骤</a><time datetime="2026-01-27T11:49:00.000Z" title="发表于 2026-01-27 19:49:00">2026-01-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/Google%20Antigravity%20%E7%99%BB%E5%BD%95%E4%B8%8D%E4%BA%86%E8%A7%A3%E5%86%B3/" title="Google Antigravity 登录不了解决">Google Antigravity 登录不了解决</a><time datetime="2026-01-22T02:38:00.000Z" title="发表于 2026-01-22 10:38:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具">连夜开发了一个 Mac 上久坐提醒工具</a><time datetime="2026-01-21T13:45:00.000Z" title="发表于 2026-01-21 21:45:00">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/20/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发">关于 AI 与开发</a><time datetime="2026-01-20T11:41:00.000Z" title="发表于 2026-01-20 19:41:00">2026-01-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/16/%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E8%A1%A8%E6%83%85%E5%8C%85/" title="制作自己表情包">制作自己表情包</a><time datetime="2026-01-16T02:21:00.000Z" title="发表于 2026-01-16 10:21:00">2026-01-16</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By 今是昨非</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div><div class="footer_custom_text"><span>日出江花红胜火，春来江水绿如蓝，能不忆江南</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>