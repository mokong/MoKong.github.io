<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>iOS 编译时间优化 | 今是昨非的博客</title><meta name="author" content="今是昨非"><meta name="copyright" content="今是昨非"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="背景目前App项目不大，但是清空后重新编译时间需要200多秒，感觉不太合理，所以，就着手排查了一下。 通常的编译时间优化都是分为三个部分  Xcode编译设置的优化 代码或函数编译时间的优化 三方库编译时间的优化  这里就根据上面三个部分来一一排查。">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 编译时间优化">
<meta property="og:url" content="http://morganwang.cn/2022/09/07/iOS%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="今是昨非的博客">
<meta property="og:description" content="背景目前App项目不大，但是清空后重新编译时间需要200多秒，感觉不太合理，所以，就着手排查了一下。 通常的编译时间优化都是分为三个部分  Xcode编译设置的优化 代码或函数编译时间的优化 三方库编译时间的优化  这里就根据上面三个部分来一一排查。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://morganwang.cn/assets/img/avatar.jpeg">
<meta property="article:published_time" content="2022-09-07T01:05:00.000Z">
<meta property="article:modified_time" content="2024-01-22T11:04:42.000Z">
<meta property="article:author" content="今是昨非">
<meta property="article:tag" content="技术">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://morganwang.cn/assets/img/avatar.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "iOS 编译时间优化",
  "url": "http://morganwang.cn/2022/09/07/iOS%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/",
  "image": "http://morganwang.cn/assets/img/avatar.jpeg",
  "datePublished": "2022-09-07T01:05:00.000Z",
  "dateModified": "2024-01-22T11:04:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "今是昨非",
      "url": "http://morganwang.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://morganwang.cn/2022/09/07/iOS%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'iOS 编译时间优化',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">188</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">今是昨非的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">iOS 编译时间优化</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">iOS 编译时间优化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-07T01:05:00.000Z" title="发表于 2022-09-07 09:05:00">2022-09-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T11:04:42.000Z" title="更新于 2024-01-22 19:04:42">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>目前App项目不大，但是清空后重新编译时间需要200多秒，感觉不太合理，所以，就着手排查了一下。</p>
<p>通常的编译时间优化都是分为三个部分</p>
<ul>
<li>Xcode编译设置的优化</li>
<li>代码或函数编译时间的优化</li>
<li>三方库编译时间的优化</li>
</ul>
<p>这里就根据上面三个部分来一一排查。</p>
<span id="more"></span>

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="Xcode编译设置的优化"><a href="#Xcode编译设置的优化" class="headerlink" title="Xcode编译设置的优化"></a>Xcode编译设置的优化</h3><p>使用的是Xcode 13.4，网上搜到的，关于Xcode设置<code>New Build System</code>，及<code>Build Settings</code>中设置<code>Debug Information Format</code>的都不需要设置了，默认已经是合理的。至于<code>Optimization Level</code>的设置，设置后，虽然编译速度可以提升，但是对于Debug不友好，所以，这里也不做设置。故而针对这项优化什么都没有处理。</p>
<h3 id="代码或函数编译时间的优化"><a href="#代码或函数编译时间的优化" class="headerlink" title="代码或函数编译时间的优化"></a>代码或函数编译时间的优化</h3><p>这方面主要是针对Swift，首先把编译耗时的方法显示出来，在<code>Build Settings</code>中<code>Other Swift Flags</code>添加如下设置，意思是显示编译超过200ms的函数或者类型检查超过300ms的函数显示warning，这里200ms是自己设定，可针对项目的真实情况设置：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="operator">-</span><span class="type">Xfrontend</span> <span class="operator">-</span>warn<span class="operator">-</span>long<span class="operator">-</span>function<span class="operator">-</span>bodies<span class="operator">=</span><span class="number">200</span></span><br><span class="line"><span class="operator">-</span><span class="type">Xfrontend</span> <span class="operator">-</span>warn<span class="operator">-</span>long<span class="operator">-</span>expression<span class="operator">-</span>type<span class="operator">-</span>checking<span class="operator">=</span><span class="number">200</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>笔者这里修改的内容有下面这几种：</p>
<p><strong>待优化代码示例1:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> count:<span class="type">Int</span> <span class="operator">=</span> <span class="type">Int</span>((<span class="keyword">self</span><span class="operator">?</span>.listParamItem.pageSize <span class="operator">??</span> <span class="number">0</span>) <span class="operator">*</span> ((<span class="keyword">self</span><span class="operator">?</span>.needRefreshPageNum <span class="operator">??</span> <span class="number">0</span>) <span class="operator">-</span> <span class="number">1</span>))</span><br><span class="line"><span class="keyword">let</span> endIndex <span class="operator">=</span> count <span class="operator">+</span> <span class="type">Int</span>(<span class="keyword">self</span><span class="operator">?</span>.listParamItem.pageSize <span class="operator">??</span> <span class="number">0</span>) <span class="operator">-</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span><span class="operator">?</span>.dataList.count <span class="operator">??</span> <span class="number">0</span>) <span class="operator">&gt;</span> endIndex &#123;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的代码中，可空和 ??混用然后类型转换，再去进行比较，代码虽然没错，但是编译真的耗时，这些方法超出了500ms。针对这些修改为如下代码，编译时间变为100ms以内，减少了5倍：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="keyword">self</span> <span class="operator">=</span> <span class="keyword">self</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> count: <span class="type">Int</span> <span class="operator">=</span> <span class="keyword">self</span>.listParamItem.pageSize <span class="operator">*</span> (<span class="keyword">self</span>.needRefreshPageNum <span class="operator">-</span> <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> endIndex: <span class="type">Int</span> <span class="operator">=</span> count <span class="operator">+</span> <span class="keyword">self</span>.listParamItem.pageSize <span class="operator">-</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">self</span>.dataList.count <span class="operator">&gt;</span> endIndex &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>待优化代码示例2：</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> dic <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;aaa&quot;</span>: xxx <span class="operator">??</span> yyy, </span><br><span class="line">    <span class="string">&quot;bbb&quot;</span>: [<span class="string">&quot;ccc&quot;</span>: <span class="string">&quot;xxx&quot;</span>, <span class="string">&quot;eee&quot;</span>: <span class="number">5</span>],</span><br><span class="line">    <span class="string">&quot;ddd&quot;</span>: <span class="number">5</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面代码中，看起来没什么问题，但是编译时间超过了200ms，可能是类型推断导致。修改为如下代码后，编译耗时不再超过200ms：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> dic1: [<span class="type">String</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [:]</span><br><span class="line">dic1[<span class="string">&quot;ccc&quot;</span>] <span class="operator">=</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line">dic1[<span class="string">&quot;eee&quot;</span>] <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dic2: [<span class="type">String</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [:]</span><br><span class="line">dic2[<span class="string">&quot;aaa&quot;</span>] <span class="operator">=</span> xxx</span><br><span class="line">dic2[<span class="string">&quot;bbb&quot;</span>] <span class="operator">=</span> dic1</span><br><span class="line">dic2[<span class="string">&quot;ddd&quot;</span>] <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>待优化代码示例3</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> type <span class="operator">==</span> .aaa <span class="operator">||</span></span><br><span class="line">type <span class="operator">==</span> .bbb <span class="operator">||</span></span><br><span class="line">type <span class="operator">==</span> .ccc <span class="operator">||</span></span><br><span class="line">type <span class="operator">==</span> .ddd <span class="operator">||</span></span><br><span class="line">type <span class="operator">==</span> .eee <span class="operator">||</span></span><br><span class="line">type <span class="operator">==</span> .xxx &#123;</span><br><span class="line">  doSomething()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    doAnotherThing()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的代码除了不优雅外，编译还耗时，修改为<code>Switch case</code>如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">switch</span> type &#123;</span><br><span class="line"><span class="keyword">case</span> .aaa,</span><br><span class="line">.bbb,</span><br><span class="line">.ccc,</span><br><span class="line">.ddd,</span><br><span class="line">.eee,</span><br><span class="line">.xxx: </span><br><span class="line">  doSomething()</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    doAnotherThing()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>待优化代码示例4</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> fontAdd: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">14.0</span></span><br><span class="line"></span><br><span class="line">protocolBtn.snp.makeConstraints &#123; make <span class="keyword">in</span></span><br><span class="line">    make.left.equalTo(agreeLabel.snp.right).offset(<span class="number">1</span>)</span><br><span class="line">    make.centerY.equalTo(checkBtn.snp.centerY)</span><br><span class="line">    make.width.equalTo(kTransitionW(<span class="number">150</span> <span class="operator">+</span> fontAdd <span class="operator">*</span> <span class="number">10</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的代码中小数和整数混合运算，让Swift来推断需要的是小数还是整数。修改为如下后，编译超时警告消失：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> fontAdd: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">14.0</span></span><br><span class="line"><span class="keyword">let</span> width: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">150.0</span> <span class="operator">+</span> fontAdd <span class="operator">*</span> <span class="number">10.0</span></span><br><span class="line"></span><br><span class="line">protocolBtn.snp.makeConstraints &#123; make <span class="keyword">in</span></span><br><span class="line">    make.left.equalTo(agreeLabel.snp.right).offset(<span class="number">1.0</span>)</span><br><span class="line">    make.centerY.equalTo(checkBtn.snp.centerY)</span><br><span class="line">    make.width.equalTo(kTransitionW(width))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后还有一类是某个方法特别长的，也出现了编译超时警告，拆分为多个子方法解决。</p>
<h3 id="三方编译库的优化"><a href="#三方编译库的优化" class="headerlink" title="三方编译库的优化"></a>三方编译库的优化</h3><p>项目中集成的三方库都是CocoaPods的方式集成，所以每次clean build后，三方库都会重新编译。设置Xcode显示编译时间，打开terminal，复制下面，去运行，重启Xcode。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ defaults write com.apple.dt.Xcode ShowBuildOperationDuration -bool YES</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后clean，重新build，可以看到详细的编译时间如下：</p>
<p><img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/screenshot-20220907-100712.png" alt="编译时间"></p>
<p>这里的<code>ZLPhotoBrowser</code>就是通过Pod方式安装的第三方库，可以看到这个库的源文件编译时间用了30秒。。。这个页面可以详细看到每个库的编译时间和项目的编译时间，针对编译时间长的三方库，改为<code>Carthage</code>方式导入，可参考<a href="https://morganwang.cn/2022/09/05/Carthage%E4%BD%BF%E7%94%A8/#more">Carthage的使用</a>。<code>Carthage</code>是将要使用的第三方库，下载并编译为<code>xcframework</code>，然后把生成的<code>xcframework</code>导入到工程中使用，故而每次clean build后，并不会重新编译，从而可以节省编译时间。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>编译时间优化的三个部分总结如下：</p>
<ul>
<li>Xcode编译设置的优化——新版本Xcode无需设置</li>
<li>代码或函数编译时间的优化——需要注意类型推断和复杂计算的优化以及运算符的使用，但是并不是所有的代码编译超时都需要进行优化，在编译优化和代码的简洁、优雅、Swift特性之间，要自己选择平衡点。</li>
<li>三方库编译时间的优化——这个优化推荐使用，针对不会更改的三方库，改为<code>Carthage</code>方式导入，可以减少重新编译时间。</li>
</ul>
<p>建议大家优化前，首先分析项目的编译时间卡在哪里，分析是三方库的编译时间太长还是项目源文件的编译时间太长，从而决定着重进行步骤二还是步骤三。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/fastred/Optimizing-Swift-Build-Times">Optimizing Swift build times</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/atlas/optimizing-build-times-in-swift-4-dc493b1cc5f5">Optimizing Build Times in Swift 4</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://morganwang.cn">今是昨非</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://morganwang.cn/2022/09/07/iOS%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/">http://morganwang.cn/2022/09/07/iOS%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://morganwang.cn" target="_blank">今是昨非的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF/">技术</a><a class="post-meta__tags" href="/tags/iOS/">iOS</a></div><div class="post-share"><div class="social-share" data-image="/assets/img/avatar.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/09/14/Xcode14%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%E4%BF%AE%E6%94%B9/" title="Xcode14编译失败修改"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Xcode14编译失败修改</div></div><div class="info-2"><div class="info-item-1">背景升级Xcode 14后，项目编译失败修改，共修改了两种编译错误：  一种是bundle code sign error，Xcode 14 needs selected Development Team for Pod Bundles 一种是Module compiled with Swift 5.6.1 cannot be imported by the Swift 5.7 compiler    其中第一种比较容易解决，第二种稍微麻烦点，解决方案如下： 解决Xcode 14 bundle code sign error这个的解决方案，直接Google，第一个stackoverflow的链接是Xcode 14 needs selected Development Team for Pod Bundles，这里面给出的解决方法是，在Podfile里增加下面代码，然后运行Pod install，设置Pod库的DEVELOPMENT_TEAM是开发者账号的team。 笔者有两个项目，其中一个是Swift为主，用下面的设置方法试了，可以解决。要注意的是如果项目有多个target，ta...</div></div></div></a><a class="pagination-related" href="/2022/09/05/Carthage%E4%BD%BF%E7%94%A8/" title="Carthage使用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Carthage使用</div></div><div class="info-2"><div class="info-item-1">背景之前一直用CocoaPods，这次做编译时间优化时，把某些Pod依赖的库改为了Carthage依赖的，这里记录一下Carthage的使用。   使用安装使用brew安装，简单方便 1brew install carthage  使用在项目所在文件夹，即.xcodeproj所在的文件夹下，创建Cartfile 1touch Cartfile  然后打开Cartfile 1open Cartfile -a Xcode  添加要依赖的第三方库，注意依赖版本的指定，指定版本和指定范围的写法，如下： 1234567891011github &quot;krzyzanowskim/CryptoSwift&quot; ~&gt; 1.4.0github &quot;evgenyneu/keychain-swift&quot; ~&gt; 19.0github &quot;ibireme/YYKit&quot;github &quot;ReactiveX/RxSwift&quot; &quot;6.5.0&quot;github &quot;onevcat/Kingfisher&quot; ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/03/29/Xcode13.3%20Archive%E5%A4%B1%E8%B4%A5/" title="Xcode 13.3 Archive 失败"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-29</div><div class="info-item-2">Xcode 13.3 Archive 失败</div></div><div class="info-2"><div class="info-item-1">背景升级Xcode 13.3之前，Debug 和 Archive 都没问题；升级 Xcode 13.3之后，Debug 没问题，Archive 就报错。错误信息是error: Abort trap: 6 (in target &#39;ZLPhotoBrowser&#39; from project &#39;Pods&#39;)，于是提了个 issue，目前已解决。   解决方案是： 123&quot;You can work around this issue by replacing UI_USER_INTERFACE_IDIOM() with UIDevice.current.userInterfaceIdiom.  这里记录分享一下，如果遇到同样问题的，可以搜一下，看是否同样是因为UI_USER_INTERFACE_IDIOM()。 </div></div></div></a><a class="pagination-related" href="/2021/12/30/iOS%20%E7%B1%BB%E4%BC%BC%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%81%E5%B1%8F%E5%B0%81%E9%9D%A2%E6%98%BE%E7%A4%BA/" title="iOS 音频后台播放 &amp;&amp; 锁屏显示及控制"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-30</div><div class="info-item-2">iOS 音频后台播放 &amp;&amp; 锁屏显示及控制</div></div><div class="info-2"><div class="info-item-1">播放锁屏通知栏显示背景播放音频时，希望通知界面能显示，且能控制音频播放。由于之前需求是进入后台时播放暂停，所以每次打开通知界面时，播放就暂停，看不到类似于音乐播放器那样的效果。后来发现，去除进入后台暂停代码后，通知界面就可以显示播放器，但是不能控制、且没有进度。   实现支持后台播放首先需要 APP 支持后台播放，即，一方面去除进入后台播放暂停的代码逻辑；另一方面，设置 Target -&gt; Signing &amp; Capabilities 中，添加 Backgroud Modes，打开 Audio, AirPlay, and Picture in Picture。图片如下：  注意设置AVAudioSession，播放前根据实际需要设置，播放后关闭 AVAudioSessionCategory类型    Category类型 当按”静音”或者锁屏时是否静音 是否可以和其他支持混音的 APP 混合播放 是否支持后台 场景举例描述    AVAudioSessionCategoryAmbient 是 是 否 常用于 APP 的背景音，比如玩游戏时还可以听音乐   AVAud...</div></div></div></a><a class="pagination-related" href="/2021/04/19/iOS%20fastlane%E6%89%93%E5%8C%85/" title="iOS 自动打包"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-19</div><div class="info-item-2">iOS 自动打包</div></div><div class="info-2"><div class="info-item-1">iOS 自动打包使用FastLane打包安装 fastlane 通过HomeBrew安装  brew install fastlane  通过Bundler安装  安装 bundler 然后在项目根目录下创建./Gemfile文件，编辑内容      1234// 安装 bundler$ gem install bundler   12345//然后在项目根目录下创建./Gemfile文件，编辑内容source &quot;https://rubygems.org&quot;gem &quot;fastlane&quot;  编辑Gemfile文件： 123456source &quot;https://rubygems.org&quot;gem &quot;fastlane&quot;, &quot;2.180.1&quot;# 如果使用Cocoapods，需要添加下面这行gem &quot;cocoapods&quot;   通过ruby gems安装  1sudo gem install fastlane  fastlane安装成功后，安装两个插件，用于版本号管理和打包成功...</div></div></div></a><a class="pagination-related" href="/2022/05/23/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9mac%E5%BA%94%E7%94%A8%E5%88%9B%E5%BB%BA/" title="图片压缩 mac 应用开发"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-23</div><div class="info-item-2">图片压缩 mac 应用开发</div></div><div class="info-2"><div class="info-item-1">图片压缩 mac 应用开发背景3年前有个项目BatchProssImage，使用 Python 写的批量压缩图片的，最新再次使用时，发现忘记了怎么使用，所以就有了把这个Python 实现的工具，做成一个简单的 mac app 的想法。   过程想法很简单：印象中当时这个工具是使用 tinypng 的 api 压缩的，所以开发一个 mac客户端，调用压缩的接口，导出照片就可以。开始动工。 首先 mac 客户端的 UI 从哪里来？之前有个项目OtoolAnalyse——分析Mach-O文件中无用的类和方法，是借LinkMapUI 来实现的。这里想了想，嗯，还可以用这个方法。打开项目一看，OC 的，还是用 Swift 写一遍吧。 UI 实现想一下大致需要哪些功能，  选择文件 || 目录 选择导出目录 开始压缩 压缩进度显示 噢噢，还有一个，tinypng apikey 输入  再考虑一下，选择导出目录是否必要？之前笔者自己使用其他 APP 选择导出时，打断先有的操作且不说，对于选择困难来说，每次考虑要导出到哪里都是一个问题，要不要新建一个文件夹，还选择同目录会是什么效果等等。 改为 ...</div></div></div></a><a class="pagination-related" href="/2025/08/21/%E6%88%91%E7%94%A8CodeBuddy%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%E8%AE%B0%E8%B4%A6APP/" title="关于我用CodeBuddy开发了几个APP的体验"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">关于我用CodeBuddy开发了几个APP的体验</div></div><div class="info-2"><div class="info-item-1">背景一直想写，但是太忙了，用CodeBuddy新开发iOSAPP，又同时想做鸿蒙APP，好家伙，是真的忙不过来。   先说体验：我觉得CodeBuddy是最厉害的，（在座的谁赞成，谁反对），🤪，就这么说吧，我用过Trae，Cursor, Windsurf，还申请了Kiro，综合下来，我觉得目前CodeBuddy对于我来说是最厉害的。 我最早用的是Trae，一开始国际版我就用了，使用期间开发了一个app吧，用着用着就智障了，就是本来好好沟通着，突然就感觉对方变傻了，还把项目修改坏了，辛辛苦苦干了好几天，一下子回到解放前了……如果是用量达标，我倒是宁可他提醒我用量达标，也不希望换成一个傻子，就像你跟一个人聊得正投缘，觉得是知己，突然间她流着口水变成了傻子，这换谁也接受不了啊🤣 噢噢，忘了说背景，我是用这些工具做app开发，从头开始开发。所以上面的体验仅供参考。 优点先说优点：  开发快速，只需要说一句话，就能快速搭建一个APP的框架，实现基本功能。 不依赖语言，通过类似的工具，模糊了开发语言的鸿沟，不必说必须学会了某个开发语言，才能开发某种APP或网站，初步能实现”任何人只要有想...</div></div></div></a><a class="pagination-related" href="/2019/09/08/CocoaPods%E7%A7%81%E6%9C%89%E5%BA%93%E7%94%9F%E6%88%90/" title="CocoaPods私有库生成"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-08</div><div class="info-item-2">CocoaPods私有库生成</div></div><div class="info-2"><div class="info-item-1">CocoaPods私有库生成</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">今是昨非</div><div class="author-info-description">技术分享、生活感悟</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">188</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mokong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/mokong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://x.com/morgan2015_wang" target="_blank" title="Twitter"><i class="fab fa-X"></i></a><a class="social-icon" href="mailto:mokong.2015.1992@email.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Xcode%E7%BC%96%E8%AF%91%E8%AE%BE%E7%BD%AE%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">Xcode编译设置的优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%88%96%E5%87%BD%E6%95%B0%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">2.2.</span> <span class="toc-text">代码或函数编译时间的优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E7%BC%96%E8%AF%91%E5%BA%93%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">2.3.</span> <span class="toc-text">三方编译库的优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/Google%20Antigravity%20%E7%99%BB%E5%BD%95%E4%B8%8D%E4%BA%86%E8%A7%A3%E5%86%B3/" title="Google 的 Antigravity登录不了解决">Google 的 Antigravity登录不了解决</a><time datetime="2026-01-22T02:48:00.000Z" title="发表于 2026-01-22 10:48:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发">关于 AI 与开发</a><time datetime="2026-01-22T02:48:00.000Z" title="发表于 2026-01-22 10:48:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具">连夜开发了一个 Mac 上久坐提醒工具</a><time datetime="2026-01-21T09:22:00.000Z" title="发表于 2026-01-21 17:22:00">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/13/%E9%B8%BF%E8%92%99%E6%88%AA%E5%9B%BE%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7/" title="无标题">无标题</a><time datetime="2025-10-13T07:24:22.000Z" title="发表于 2025-10-13 15:24:22">2025-10-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/28/%E4%BD%BF%E7%94%A8%E4%B8%80%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0OpenConnect%E8%BF%9E%E6%8E%A5%E5%86%85%E7%BD%91/" title="无标题">无标题</a><time datetime="2025-09-28T07:28:52.000Z" title="发表于 2025-09-28 15:28:52">2025-09-28</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By 今是昨非</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div><div class="footer_custom_text"><span>日出江花红胜火，春来江水绿如蓝，能不忆江南</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>