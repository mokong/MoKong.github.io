<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>iOS输入框字符限制 | 今是昨非的博客</title><meta name="author" content="今是昨非"><meta name="copyright" content="今是昨非"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="背景小知识点记录，textField的markedTextRange的使用，如果你已经知道了，就不需要再看了。 iOS输入框字符限制，不同实现方式的对比：  方法1，通过监听textField的UIControl.Event.editingChanged，在对应的方法里做长度拦截判断 方法2，通过textField的代理方法，textField(_ textField: UITextField,">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS输入框字符限制">
<meta property="og:url" content="http://morganwang.cn/2022/08/20/iOS%E8%BE%93%E5%85%A5%E6%A1%86%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6/index.html">
<meta property="og:site_name" content="今是昨非的博客">
<meta property="og:description" content="背景小知识点记录，textField的markedTextRange的使用，如果你已经知道了，就不需要再看了。 iOS输入框字符限制，不同实现方式的对比：  方法1，通过监听textField的UIControl.Event.editingChanged，在对应的方法里做长度拦截判断 方法2，通过textField的代理方法，textField(_ textField: UITextField,">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://morganwang.cn/assets/img/avatar.jpeg">
<meta property="article:published_time" content="2022-08-20T02:56:00.000Z">
<meta property="article:modified_time" content="2024-01-22T11:04:42.000Z">
<meta property="article:author" content="今是昨非">
<meta property="article:tag" content="技术">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://morganwang.cn/assets/img/avatar.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "iOS输入框字符限制",
  "url": "http://morganwang.cn/2022/08/20/iOS%E8%BE%93%E5%85%A5%E6%A1%86%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6/",
  "image": "http://morganwang.cn/assets/img/avatar.jpeg",
  "datePublished": "2022-08-20T02:56:00.000Z",
  "dateModified": "2024-01-22T11:04:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "今是昨非",
      "url": "http://morganwang.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://morganwang.cn/2022/08/20/iOS%E8%BE%93%E5%85%A5%E6%A1%86%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'iOS输入框字符限制',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">188</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">今是昨非的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">iOS输入框字符限制</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">iOS输入框字符限制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-20T02:56:00.000Z" title="发表于 2022-08-20 10:56:00">2022-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T11:04:42.000Z" title="更新于 2024-01-22 19:04:42">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>小知识点记录，textField的<code>markedTextRange</code>的使用，如果你已经知道了，就不需要再看了。</p>
<p>iOS输入框字符限制，不同实现方式的对比：</p>
<ul>
<li>方法1，通过监听textField的<code>UIControl.Event.editingChanged</code>，在对应的方法里做长度拦截判断</li>
<li>方法2，通过textField的代理方法，<code>textField(_ textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -&gt; Bool</code>判断。</li>
</ul>
<span id="more"></span>

<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><p>假设产品要求这个输入框限制输入6个字，怎么判断？下面来看下</p>
<h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><p>声明一个自定义的MWCustomTF，然后监听<code>editingChanged</code>事件，在事件里判断输入字符是否超出最大输入长度，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MWCustomTF</span>: <span class="title">UITextField</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - properties</span></span><br><span class="line">    <span class="keyword">var</span> kMaxInputLength: <span class="type">Int</span> <span class="operator">=</span> <span class="number">6</span> <span class="comment">// 最大输入长度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - init</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">init</span>(<span class="params">frame</span>: <span class="type">CGRect</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">        </span><br><span class="line">        addTarget(<span class="keyword">self</span>, action: #selector(handleTFChanged(<span class="keyword">_</span>:)), for: <span class="type">UIControl</span>.<span class="type">Event</span>.editingChanged)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="function"><span class="keyword">init?</span>(<span class="params">coder</span>: <span class="type">NSCoder</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;init(coder:) has not been implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - utils</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - action</span></span><br><span class="line">    <span class="keyword">@objc</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">handleTFChanged</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="type">UITextField</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> text <span class="operator">=</span> sender.text <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> textCount <span class="operator">=</span> text.count</span><br><span class="line">        <span class="keyword">let</span> minCount <span class="operator">=</span> <span class="built_in">min</span>(textCount, kMaxInputLength)</span><br><span class="line">        <span class="keyword">self</span>.text <span class="operator">=</span> (text <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: minCount)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - other</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行后调试，发现，确实限制了最大输入长度，但是有两个问题：</p>
<ul>
<li>问题1: 在输入中文时，输入拼音也不能超过最大输入长度了，比如：目前最大长度是6，那么输入超过6个单词的拼音时，输入不了，比如想输入上海，直接就把shang显示到输入框中了。</li>
<li>问题2: 这种方式，在iOS12.0的手机上会出现，输入拼音时直接把拼音显示到了输入框内，本来是输入拼音选汉字，但是加了这个方法后在iOS12上，输入拼音到过程中直接把拼音就显示到输入框中了，完全乱了。所以iOS12上完全不可用。</li>
</ul>
<p>效果如下：</p>
<p><img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/PageCallback1.gif" alt="playback1"></p>
<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><p>那既然上面的方法1在iOS12上完全不能用，来试试方法2的实现，即在textField的代理方法中判断，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UITextFieldDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@IBOutlet</span> <span class="keyword">var</span> textField: <span class="type">UITextField</span>! <span class="comment">// Link this to a UITextField in Storyboard</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        textField.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">textField</span>(<span class="keyword">_</span> <span class="params">textField</span>: <span class="type">UITextField</span>, <span class="params">shouldChangeCharactersIn</span> <span class="params">range</span>: <span class="type">NSRange</span>, <span class="params">replacementString</span> <span class="params">string</span>: <span class="type">String</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> textFieldText <span class="operator">=</span> textField.text,</span><br><span class="line">            <span class="keyword">let</span> rangeOfTextToReplace <span class="operator">=</span> <span class="type">Range</span>(range, in: textFieldText) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> substringToReplace <span class="operator">=</span> textFieldText[rangeOfTextToReplace]</span><br><span class="line">        <span class="keyword">let</span> count <span class="operator">=</span> textFieldText.count <span class="operator">-</span> substringToReplace.count <span class="operator">+</span> string.count</span><br><span class="line">        <span class="keyword">return</span> count <span class="operator">&lt;=</span> <span class="number">6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行调试，查看运行效果，会发现，首先iOS12上的那种错乱解决了；其次超出6个时不会自动把拼音带入到输入框内，只是限制超出后到输入无效。<br>所以这种方法，上面的问题解决了，但是还是有一个问题：就是当你输入了5个字后，只能再输入一个拼音，惊不惊喜？</p>
<p>效果如下：</p>
<p><img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/PageCallback2.gif" alt="playback2"></p>
<p>所以上面的方法也是不行的，那怎么处理呢？我想要输入拼音时不校验，在选择拼音变成汉字时，再去校验这个长度是否超出？要怎么做呢？</p>
<p>这时就需要textField的<code>markedTextRange</code>了，<code>markedTextRange</code>的定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* If text can be selected, it can be marked. Marked text represents provisionally</span></span><br><span class="line"><span class="comment"> * inserted text that has yet to be confirmed by the user.  It requires unique visual</span></span><br><span class="line"><span class="comment"> * treatment in its display.  If there is any marked text, the selection, whether a</span></span><br><span class="line"><span class="comment"> * caret or an extended range, always resides within.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Setting marked text either replaces the existing marked text or, if none is present,</span></span><br><span class="line"><span class="comment"> * inserts it from the current selection. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">3.2</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">var</span> markedTextRange: <span class="type">UITextRange</span>? &#123; <span class="keyword">get</span> &#125; <span class="comment">// Nil if no marked text.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据<code>markedTextRange</code>是否为空，可以判断当前是不是在输入拼音。所以要怎么处理呢？<br>由于方法一之前不兼容iOS12，所以我们优先考虑在方法二的代理方法中添加<code>markedTextRange</code>是否为空的判断，但是在代理方法中打印<code>textField.markedTextRange</code>会发现，这个地方打印出来的range比真实的慢一步，即输入了一个拼音时，这个方法中打印出来时nil，输入第二个拼音后，这个方法中打印出来的是<code>range = 0...1</code>，所以在这个方法里并不能准确的判断这个值。其实是因为这个方法的调用在前面，这个方法返回了true之后，<code>markedTextRange</code>才会变化，所以在这个方法里看到的<code>markedTextRange</code>永远是慢一步的。</p>
<p>所以只能是接着用方法一，因为方法一是监听<code>textField</code>的<code>editingChanged</code>事件，所以这个事件里获取的<code>markedTextRange</code>应该是准确的。代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MWCustomTF</span>: <span class="title">UITextField</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - properties</span></span><br><span class="line">    <span class="keyword">var</span> kMaxInputLength: <span class="type">Int</span> <span class="operator">=</span> <span class="number">6</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - init</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">init</span>(<span class="params">frame</span>: <span class="type">CGRect</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">        </span><br><span class="line">        addTarget(<span class="keyword">self</span>, action: #selector(handleEditingChanged(<span class="keyword">_</span>:)), for: <span class="type">UIControl</span>.<span class="type">Event</span>.editingChanged)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="function"><span class="keyword">init?</span>(<span class="params">coder</span>: <span class="type">NSCoder</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;init(coder:) has not been implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - utils</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - action</span></span><br><span class="line">    <span class="keyword">@objc</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">handleEditingChanged</span>(<span class="keyword">_</span> <span class="params">sender</span>: <span class="type">UITextField</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> text <span class="operator">=</span> sender.text <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> sender.markedTextRange <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> textCount <span class="operator">=</span> text.count</span><br><span class="line">        <span class="keyword">let</span> minCount <span class="operator">=</span> <span class="built_in">min</span>(textCount, kMaxInputLength)</span><br><span class="line">        <span class="keyword">self</span>.text <span class="operator">=</span> (text <span class="keyword">as</span> <span class="type">NSString</span>).substring(to: minCount)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - other</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行调试后，发现完美，当输入拼音时，不校验是否超出最长长度，而选择拼音变为汉字后，超出最长长度的汉字将被截断。binggo，正是我们想要的结果。</p>
<p>最终效果如下：</p>
<p><img src="https://raw.githubusercontent.com/mokong/BlogImages/main/img/PageCallback3.gif" alt="playback3"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/25223407/max-length-uitextfield">Max length UITextField</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://morganwang.cn">今是昨非</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://morganwang.cn/2022/08/20/iOS%E8%BE%93%E5%85%A5%E6%A1%86%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6/">http://morganwang.cn/2022/08/20/iOS%E8%BE%93%E5%85%A5%E6%A1%86%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://morganwang.cn" target="_blank">今是昨非的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF/">技术</a><a class="post-meta__tags" href="/tags/iOS/">iOS</a></div><div class="post-share"><div class="social-share" data-image="/assets/img/avatar.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/08/26/%E5%BD%95%E9%9F%B3%E5%B4%A9%E6%BA%83%E6%8E%92%E6%9F%A5/" title="一次诡异的录音崩溃排查"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">一次诡异的录音崩溃排查</div></div><div class="info-2"><div class="info-item-1">背景上午突然有用户反馈，使用录音功能崩溃。起初以为是最近更新的APP新版本有问题，赶紧去排查。   排查首先在测试手机上，测试环境调试，发现并没有崩溃，长出了一口气，说明不是所有用户都有，不是新版本改出来的问题。 然后去听云后台看日志，发现崩溃的地方是初始化AVAudioRecorder的方法——[[AVAudioRecorder alloc] initWithURL:url settings:recordSettings error:&amp;error];。很费解，只是简单的初始化方法，为什么会导致崩溃呢？ 一开始猜测会不会是用户录音权限没开，导致开始录音的时候崩溃。尝试后发现如果权限关闭，在进入录音页面前就会提示权限未开启，去开启权限，并不能进入到录音步骤。 然后怀疑会不会是初始化的url为空，又或者机型不支持设置recordSettings中的某些参数？搜索后，发现有url为空崩溃的条目，所以这里大概率也是初始化的url为空。 继续排查，发现初始化的url，是本地的缓存文件夹中Audio文件夹，并且文件名字是取日期+时分秒用于避免重复，格式为yyyyMMdd_HHmmss...</div></div></div></a><a class="pagination-related" href="/2022/08/16/iOS%E7%94%BB%E4%B8%AD%E7%94%BB%E6%B5%AE%E7%AA%97%E8%87%AA%E5%AE%9A%E4%B9%89/" title="一文学会iOS画中画浮窗"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">一文学会iOS画中画浮窗</div></div><div class="info-2"><div class="info-item-1">背景之前有看到有人用画中画实现时分秒的计时，顺手收藏了，一直没来及看。最近使用《每日英语听力》，突然发现它用画中画实现了听力语句的显示，顿时来了兴趣，所以来研究一下是怎么实现的？顺便也研究下画中画时分秒计时的实现——每次遇到某些平台每天固定时间开抢的时候，我都希望iPhone能够显示具体到秒的计时，这样就能知道什么时候开始点击合适，而不是每次都提前一分钟在那里不停的点点点却什么都抢不到。。。    实现画中画一般是用来浮窗播放视频的，那如何让画中画播放自定义的界面而不是视频？下面分为5步具体来看下：  实现画中画功能，需要设置哪些开关，实现哪些方法； 基本的使用系统播放器时，画中画的实现； 自定义播放器时，画中画功能的实现又需要如何设置，有哪些不同； 如何通过画中画实现时分秒计时功能； 《每日英语听力》通过画中画播放英语听力语句时怎么实现的？  APP支持画中画功能如何让APP支持画中画功能？首先需要设置App支持BackgroundModes，然后勾选BackgroundModes中的Audio, Airplay, and Picture in Picture。 操作如下：  ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/03/16/Pod%20%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E7%9B%B8%E4%BA%92%E5%BC%95%E7%94%A8/" title="Pod 私有库相互引用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-16</div><div class="info-item-2">Pod 私有库相互引用</div></div><div class="info-2"><div class="info-item-1">私有库的相互引用文章是转载自OC和Swift混合开发(Pod私有库的相互引用)，在这里记录一下，方便以后查看。   概述：该文档主要介绍OC和Swift混合开发相互调用，包括3大类情况和12种具体情形。 三大类情况：  主工程内的混合互调，  主工程和Pod三方库之间的混合互调，  Pod三方库和其他Pod三方库之间的混合互调。   十二种情形：  主工程内的OC 调用 主工程内的OC：#import “NSObject.h”   导入头文件直接调用。   主工程内的OC 调用 主工程内的Swift：   1. 主工程中创建.pch文件，在TARGETS -&gt; Build Setting -&gt; 搜索pch -&gt; 设置.pch文件的路径，     2. 在.pch文件中添加 ：       例如：#import “xxxxx_Swift.h”        (该文件命名规则为：”工程名_Swift.h”，该文件为系统自动生成) ，    3. 编译之后才可自动识别需要调用的Swift的文件 。  主工程内的OC 调用 OC的Pod三方库：     #import ...</div></div></div></a><a class="pagination-related" href="/2024/04/19/Mac%E6%89%AB%E6%8F%8FiOS%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6/" title="Python实现提醒iOS描述文件有效期"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-19</div><div class="info-item-2">Python实现提醒iOS描述文件有效期</div></div><div class="info-2"><div class="info-item-1">Python实现提醒iOS描述文件有效期背景公司企业APP描述文件过期，没有提醒，导致当天出现不可用的问题。 为了避免再发生类似的问题，笔者想要写一个Python脚本，读取描述文件，获取有效期，设置提醒，且自动运行。    实现首先再来理一下思路，所有的描述文件都在~/Library/MobileDevice/Provisioning Profiles/目录下，但是里面的内容通常不会自动删除，过期的或者重复的都在这个目录中，而且这个目录下的文件名是uuid命名的和Xcode中的文件名字也不能直接对应，所以一眼看去，只能用一个字形容：乱。 如果账号是管理员，直接登录在电脑上，项目中用的自动管理描述文件的，还好一些，现在会自动续期。但是如果账号是开发者，发布的描述文件没有权限用自动管理的，就需要注意这个描述文件有效期的问题。 再来理一下思路，想要的是一个读取描述文件夹下所有描述文件，获取描述文件中的内容，根据有效期，设置提醒，且自动运行的脚本。 那这里面最重要的是什么？是获取描述文件的内容，这关系到这个思路是否可行。 获取描述文件的内容首先，来看下，描述文件的格式是uuid.mobi...</div></div></div></a><a class="pagination-related" href="/2021/08/04/iOS%E8%99%9A%E6%8B%9F%E4%BD%8D%E7%BD%AE%E8%B0%83%E7%A0%94%E4%B8%8E%E9%A2%84%E9%98%B2/" title="iOS 虚拟定位原理与预防"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-04</div><div class="info-item-2">iOS 虚拟定位原理与预防</div></div><div class="info-2"><div class="info-item-1">iOS 虚拟定位原理与预防背景说到虚拟定位，常有印象都是安卓上的分身软件甚至系统自带的位置穿越（笔者曾经使用过ZUK Z2系统自带的位置穿越），会认为iOS上虚拟定位比较困难。笔者没调研之前也是这么认为，之前已知的虚拟定位是使用Xcode添加GPX文件，编辑经纬度，从而实现虚拟定位。但是这种操作也只有熟悉iOS开发的人才能操作，而且需要mac电脑，故而笔者印象中也是iOS上虚拟定位比较困难。   然而经过调研之后，笔者发现，iOS的虚拟定位没有那么困难，甚至相比于安卓更简单。下面就来介绍一下iOS中几种虚拟定位的方法。 虚拟定位的几种办法及原理笔者调研后，发现iOS上面虚拟定位大致可有4中情况：  使用Xcode通过GPX文件虚拟定位 使用爱思助手中的虚拟定位功能直接虚拟定位 通过外接设备，比如蓝牙和手机连接，发送虚拟定位数据来虚拟定位 越狱设备中通过hook定位方法，来虚拟定位  下面就来一个个分析实践： 使用Xcode通过GPX文件虚拟定位使用Xcode通过GPX文件虚拟定位，iOS开发一般比较熟悉，操作步骤是： 新创建一个iOS项目，然后添加文件，选择创建GPX文件  编辑...</div></div></div></a><a class="pagination-related" href="/2026/01/22/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-22</div><div class="info-item-2">关于 AI 与开发</div></div><div class="info-2"><div class="info-item-1">背景最近看到了很多 AI 与开发的话题，比如 # AI 不能帮你背 D 绩效、# 如何看待在线笔试中使用 AI 作弊、# 我们真的应该完全放弃《古法编程》？、# 大家都来分享一下自己的 vibe coding 技巧等等，我也想分享一下我自己的看法。    思考参考 # 大家都来分享一下自己的 vibe coding 技巧 # AI 不能帮你背 D 绩效 # 如何看待在线笔试中使用 AI 作弊 # 我们真的应该完全放弃《古法编程》？  </div></div></div></a><a class="pagination-related" href="/2021/05/13/%E5%A6%82%E4%BD%95%E8%AE%A9iOS%E6%8E%A8%E9%80%81%E6%92%AD%E6%94%BE%E8%AF%AD%E9%9F%B3/" title="如何让iOS推送播放语音"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-13</div><div class="info-item-2">如何让iOS推送播放语音</div></div><div class="info-2"><div class="info-item-1">本文发表在《搜狐技术产品》公众号如何让iOS推送播放语音 iOS 推送播放语音一：背景iOS 推送播放语音的需求调研，即收到推送后，播放推送的文案，文案的内容不固定。类似于支付宝和微信的收款到账语音。  只有iOS10以上才支持app被唤醒后在后台/锁屏状态下播放音频。所以iOS10以下的设备，在收到VoIP Push后只能在local push上设定一段固定铃声，这也是为什么iOS10以下只有“微信支付收款到账”。 iOS 12.0之前，后台播放音频未被限制，直接使用Notification Service Extension (iOS 10.0以后才支持) 功能使用系统提供的功能AVSpeechSynthesizer即可。 iOS 12.0之后，Notification Service Extension后台播放音频功能被限制，所以播放实现起来比较困难。 如果要上架商店，只有播放固定的音频，或固定拼接的音频，通过设置通知的声音或者发送本地通知设置本地通知的声音来播放 如果无需上架商店，可以手动打开Notification Service Extension的后台播放，    ...</div></div></div></a><a class="pagination-related" href="/2022/09/14/Xcode14%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%E4%BF%AE%E6%94%B9/" title="Xcode14编译失败修改"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-14</div><div class="info-item-2">Xcode14编译失败修改</div></div><div class="info-2"><div class="info-item-1">背景升级Xcode 14后，项目编译失败修改，共修改了两种编译错误：  一种是bundle code sign error，Xcode 14 needs selected Development Team for Pod Bundles 一种是Module compiled with Swift 5.6.1 cannot be imported by the Swift 5.7 compiler    其中第一种比较容易解决，第二种稍微麻烦点，解决方案如下： 解决Xcode 14 bundle code sign error这个的解决方案，直接Google，第一个stackoverflow的链接是Xcode 14 needs selected Development Team for Pod Bundles，这里面给出的解决方法是，在Podfile里增加下面代码，然后运行Pod install，设置Pod库的DEVELOPMENT_TEAM是开发者账号的team。 笔者有两个项目，其中一个是Swift为主，用下面的设置方法试了，可以解决。要注意的是如果项目有多个target，ta...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">今是昨非</div><div class="author-info-description">技术分享、生活感悟</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">188</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mokong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/mokong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://x.com/morgan2015_wang" target="_blank" title="Twitter"><i class="fab fa-X"></i></a><a class="social-icon" href="mailto:mokong.2015.1992@email.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">2.</span> <span class="toc-text">对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%951"><span class="toc-number">2.1.</span> <span class="toc-text">方法1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%952"><span class="toc-number">2.2.</span> <span class="toc-text">方法2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">3.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/Google%20Antigravity%20%E7%99%BB%E5%BD%95%E4%B8%8D%E4%BA%86%E8%A7%A3%E5%86%B3/" title="Google 的 Antigravity登录不了解决">Google 的 Antigravity登录不了解决</a><time datetime="2026-01-22T02:48:00.000Z" title="发表于 2026-01-22 10:48:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发">关于 AI 与开发</a><time datetime="2026-01-22T02:48:00.000Z" title="发表于 2026-01-22 10:48:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具">连夜开发了一个 Mac 上久坐提醒工具</a><time datetime="2026-01-21T09:22:00.000Z" title="发表于 2026-01-21 17:22:00">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/13/%E9%B8%BF%E8%92%99%E6%88%AA%E5%9B%BE%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7/" title="无标题">无标题</a><time datetime="2025-10-13T07:24:22.000Z" title="发表于 2025-10-13 15:24:22">2025-10-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/28/%E4%BD%BF%E7%94%A8%E4%B8%80%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0OpenConnect%E8%BF%9E%E6%8E%A5%E5%86%85%E7%BD%91/" title="无标题">无标题</a><time datetime="2025-09-28T07:28:52.000Z" title="发表于 2025-09-28 15:28:52">2025-09-28</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By 今是昨非</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div><div class="footer_custom_text"><span>日出江花红胜火，春来江水绿如蓝，能不忆江南</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>