<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>iOS 音频后台播放 &amp;&amp; 锁屏显示及控制 | 今是昨非的博客</title><meta name="author" content="今是昨非"><meta name="copyright" content="今是昨非"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="播放锁屏通知栏显示背景播放音频时，希望通知界面能显示，且能控制音频播放。由于之前需求是进入后台时播放暂停，所以每次打开通知界面时，播放就暂停，看不到类似于音乐播放器那样的效果。后来发现，去除进入后台暂停代码后，通知界面就可以显示播放器，但是不能控制、且没有进度。">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 音频后台播放 &amp;&amp; 锁屏显示及控制">
<meta property="og:url" content="http://morganwang.cn/2021/12/30/iOS%20%E7%B1%BB%E4%BC%BC%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%81%E5%B1%8F%E5%B0%81%E9%9D%A2%E6%98%BE%E7%A4%BA/index.html">
<meta property="og:site_name" content="今是昨非的博客">
<meta property="og:description" content="播放锁屏通知栏显示背景播放音频时，希望通知界面能显示，且能控制音频播放。由于之前需求是进入后台时播放暂停，所以每次打开通知界面时，播放就暂停，看不到类似于音乐播放器那样的效果。后来发现，去除进入后台暂停代码后，通知界面就可以显示播放器，但是不能控制、且没有进度。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://morganwang.cn/assets/img/avatar.jpeg">
<meta property="article:published_time" content="2021-12-30T01:26:00.000Z">
<meta property="article:modified_time" content="2024-01-22T11:04:42.000Z">
<meta property="article:author" content="今是昨非">
<meta property="article:tag" content="技术">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://morganwang.cn/assets/img/avatar.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "iOS 音频后台播放 && 锁屏显示及控制",
  "url": "http://morganwang.cn/2021/12/30/iOS%20%E7%B1%BB%E4%BC%BC%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%81%E5%B1%8F%E5%B0%81%E9%9D%A2%E6%98%BE%E7%A4%BA/",
  "image": "http://morganwang.cn/assets/img/avatar.jpeg",
  "datePublished": "2021-12-30T01:26:00.000Z",
  "dateModified": "2024-01-22T11:04:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "今是昨非",
      "url": "http://morganwang.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://morganwang.cn/2021/12/30/iOS%20%E7%B1%BB%E4%BC%BC%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%81%E5%B1%8F%E5%B0%81%E9%9D%A2%E6%98%BE%E7%A4%BA/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'iOS 音频后台播放 && 锁屏显示及控制',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">190</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">今是昨非的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">iOS 音频后台播放 &amp;&amp; 锁屏显示及控制</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">iOS 音频后台播放 &amp;&amp; 锁屏显示及控制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-30T01:26:00.000Z" title="发表于 2021-12-30 09:26:00">2021-12-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T11:04:42.000Z" title="更新于 2024-01-22 19:04:42">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="播放锁屏通知栏显示"><a href="#播放锁屏通知栏显示" class="headerlink" title="播放锁屏通知栏显示"></a>播放锁屏通知栏显示</h3><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>播放音频时，希望通知界面能显示，且能控制音频播放。由于之前需求是进入后台时播放暂停，所以每次打开通知界面时，播放就暂停，看不到类似于音乐播放器那样的效果。后来发现，去除进入后台暂停代码后，通知界面就可以显示播放器，但是不能控制、且没有进度。</p>
<span id="more"></span>

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="支持后台播放"><a href="#支持后台播放" class="headerlink" title="支持后台播放"></a>支持后台播放</h3><p>首先需要 APP 支持后台播放，即，一方面去除进入后台播放暂停的代码逻辑；另一方面，设置 Target -&gt; Signing &amp; Capabilities 中，添加 Backgroud Modes，打开 Audio, AirPlay, and Picture in Picture。图片如下：</p>
<p><img src="https://inews.gtimg.com/newsapp_ls/0/14364376469/0.png" alt="企业微信20211229-141138.png"></p>
<p>注意设置<code>AVAudioSession</code>，播放前根据实际需要设置，播放后关闭</p>
<p><strong><code>AVAudioSessionCategory</code>类型</strong></p>
<table>
<thead>
<tr>
<th>Category类型</th>
<th>当按”静音”或者锁屏时是否静音</th>
<th>是否可以和其他支持混音的 APP 混合播放</th>
<th>是否支持后台</th>
<th>场景举例描述</th>
</tr>
</thead>
<tbody><tr>
<td>AVAudioSessionCategoryAmbient</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>常用于 APP 的背景音，比如玩游戏时还可以听音乐</td>
</tr>
<tr>
<td>AVAudioSessionCategorySoloAmbient</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>同样是背景音，但是用于玩游戏时不想听音乐的场景</td>
</tr>
<tr>
<td>AVAudioSessionCategoryPlayback</td>
<td>否</td>
<td>默认不可以，但可支持</td>
<td>是</td>
<td>音乐播放，锁屏时还能听音乐</td>
</tr>
<tr>
<td>AVAudioSessionCategoryRecord</td>
<td>否</td>
<td>否，只能录音</td>
<td>是</td>
<td>录音机，录音时，其他音乐不能播放</td>
</tr>
<tr>
<td>AVAudioSessionCategoryPlayAndRecord</td>
<td>否</td>
<td>默认可以，即可以录音也可以播放</td>
<td>是</td>
<td>边播边录，比如 VOIP 这样的场景</td>
</tr>
<tr>
<td>AVAudioSessionCategoryAudioProcessing</td>
<td>否</td>
<td>否，硬件解码音频，不能播放和录制</td>
<td>是</td>
<td>用于音频格式处理</td>
</tr>
<tr>
<td>AVAudioSessionCategoryMultiRoute</td>
<td>否</td>
<td>是，多种输入输出</td>
<td>否</td>
<td>耳机、USB 设备同时播放</td>
</tr>
</tbody></table>
<p><strong><code>AVAudioSessionCategoryOption</code>类型</strong></p>
<table>
<thead>
<tr>
<th>CategoryOption类型</th>
<th>描述</th>
<th>适用类别</th>
</tr>
</thead>
<tbody><tr>
<td>AVAudioSessionCategoryOptionMixWithOthers</td>
<td>支持和其他APP 混合播放</td>
<td>AVAudioSessionCategoryPlayAndRecord、AVAudioSessionCategoryPlayback、AVAudioSessionCategoryMultiRoute</td>
</tr>
<tr>
<td>AVAudioSessionCategoryOptionDuckOthers</td>
<td>调低其他 APP 音频音量，突出本 APP 的音量</td>
<td>AVAudioSessionCategoryPlayAndRecord、AVAudioSessionCategoryPlayback、AVAudioSessionCategoryMultiRoute</td>
</tr>
<tr>
<td>AVAudioSessionCategoryOptionAllowBluetooth</td>
<td>支持蓝牙音频输入</td>
<td>AVAudioSessionCategoryRecord、AVAudioSessionCategoryPlayAndRecord</td>
</tr>
<tr>
<td>AVAudioSessionCategoryOptionDefaultToSpeaker</td>
<td>设置默认输出音频到扬声器</td>
<td>AVAudioSessionCategoryPlayAndRecord</td>
</tr>
<tr>
<td>AVAudioSessionCategoryOptionInterruptSpokenAudioAndMixWithOthers</td>
<td>App 偶尔有用到音频播放，且播放时停止其他应用音频</td>
<td>AVAudioSessionCategoryPlayback、AVAudioSessionCategoryPlayAndRecord、AVAudioSessionCategoryMultiRoute</td>
</tr>
<tr>
<td>AVAudioSessionCategoryOptionAllowBluetoothA2DP</td>
<td>支持立体声蓝牙</td>
<td>AVAudioSessionCategoryPlayAndRecord</td>
</tr>
<tr>
<td>AVAudioSessionCategoryOptionAllowAirPlay</td>
<td>支持 AirPlay 设备</td>
<td>AVAudioSessionCategoryPlayAndRecord</td>
</tr>
</tbody></table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupAudioSession</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 设置.notifyOthersOnDeactivation，当 Active 为 false 是生效，通知系统本应用播放已结束，可继续其他 APP 播放</span></span><br><span class="line">        <span class="keyword">try</span> <span class="type">AVAudioSession</span>.sharedInstance().setActive(<span class="literal">true</span>, options: <span class="type">AVAudioSession</span>.<span class="type">SetActiveOptions</span>.notifyOthersOnDeactivation)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据实际需要切换设置不同的 Category</span></span><br><span class="line">        <span class="keyword">try</span> <span class="type">AVAudioSession</span>.sharedInstance().setCategory(<span class="type">AVAudioSession</span>.<span class="type">Category</span>.playback, options: <span class="type">AVAudioSession</span>.<span class="type">CategoryOptions</span>.duckOthers)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;set AudioSession error: %@&quot;</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="锁屏通知栏显示"><a href="#锁屏通知栏显示" class="headerlink" title="锁屏通知栏显示"></a>锁屏通知栏显示</h3><p>APP 支持后台播放后，可以看到在通知栏已经有显示了，但是播放时没有进度，没有标题，没有图片，只有 APP 的名字和 小Icon。而要修改这些信息的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;MediaPlayer/MPNowPlayingInfoCenter.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;MediaPlayer/MPRemoteCommandCenter.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;MediaPlayer/MPRemoteCommand.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;MediaPlayer/MPMediaItem.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新通知栏显示</span></span><br><span class="line">- (<span class="keyword">void</span>)updateNowPlaingInfo &#123;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    <span class="comment">// 设置歌曲标题</span></span><br><span class="line">    [dict setValue:<span class="string">@&quot;Title&quot;</span> forKey:<span class="built_in">MPMediaItemPropertyTitle</span>];</span><br><span class="line">    <span class="comment">// 设置歌手名</span></span><br><span class="line">    [dict setValue:<span class="string">@&quot;Artist&quot;</span> forKey:<span class="built_in">MPMediaItemPropertyArtist</span>];</span><br><span class="line">    <span class="comment">// 设置专辑名</span></span><br><span class="line">    [dict setValue:<span class="string">@&quot;AlbumTItle&quot;</span> forKey:<span class="built_in">MPMediaItemPropertyAlbumTitle</span>];</span><br><span class="line">    <span class="comment">// 设置显示的图片</span></span><br><span class="line">    <span class="built_in">MPMediaItemArtwork</span> *artwork = [[<span class="built_in">MPMediaItemArtwork</span> alloc] initWithImage:ArtImage];</span><br><span class="line">    [dict setValue:artwork forKey:<span class="built_in">MPMediaItemPropertyArtwork</span>];</span><br><span class="line">    <span class="comment">// 设置歌曲时长</span></span><br><span class="line">    <span class="built_in">NSTimeInterval</span> duration = <span class="keyword">self</span>.player.duration;</span><br><span class="line">    [dict setValue:[<span class="built_in">NSNumber</span> numberWithDouble:duration] forKey:<span class="built_in">MPMediaItemPropertyPlaybackDuration</span>];</span><br><span class="line">    <span class="comment">// 设置已经播放时长</span></span><br><span class="line">    <span class="built_in">NSTimeInterval</span> currentTime = <span class="keyword">self</span>.player.currentTime;</span><br><span class="line">    [dict setValue:[<span class="built_in">NSNumber</span> numberWithDouble:currentTime] forKey:<span class="built_in">MPNowPlayingInfoPropertyElapsedPlaybackTime</span>];</span><br><span class="line">    <span class="comment">// 设置播放速率</span></span><br><span class="line">    [dict setValue:@(<span class="number">1.0</span>) forKey:<span class="built_in">MPNowPlayingInfoPropertyPlaybackRate</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新</span></span><br><span class="line">    [[<span class="built_in">MPNowPlayingInfoCenter</span> defaultCenter] setNowPlayingInfo:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而如果想要播放完成后，不在通知栏显示，则可如下设置</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[[<span class="built_in">MPNowPlayingInfoCenter</span> defaultCenter] setNowPlayingInfo:@&#123;&#125;];</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置通知栏控制播放的暂停、上集、下集，通过设置<code>MPRemoteCommandCenter</code>中的属性可以控制对应功能是否打开，而响应事件的处理有两种方法：</p>
<ul>
<li>方法一，通过<code>remoteControlReceivedWithEvent:</code>方法，响应对应事件</li>
<li>方法二：通过<code>MPRemoteCommandCenter</code>的<code>Command</code>来<code>addTarget</code>来处理对应事件</li>
</ul>
<p>设置通知栏对应功能是否打开的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 在 AppDelegate 中，或者对应播放的 Controller 中，打开接收系统控制事件</span></span><br><span class="line"><span class="comment">// 接收系统控制事件</span></span><br><span class="line">[[<span class="built_in">UIApplication</span> sharedApplication] beginReceivingRemoteControlEvents];</span><br><span class="line">[<span class="keyword">self</span> becomeFirstResponder];</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setupCommandCenter &#123;</span><br><span class="line">    <span class="built_in">MPRemoteCommandCenter</span> *commandCenter = [<span class="built_in">MPRemoteCommandCenter</span> sharedCommandCenter];</span><br><span class="line">    [commandCenter.playCommand removeTarget:<span class="keyword">self</span>];</span><br><span class="line">    [commandCenter.pauseCommand removeTarget:<span class="keyword">self</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 禁用 pre, next</span></span><br><span class="line">    commandCenter.previousTrackCommand.enabled = <span class="literal">NO</span>;</span><br><span class="line">    commandCenter.nextTrackCommand.enabled = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    commandCenter.playCommand.enabled = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 暂停</span></span><br><span class="line">    commandCenter.pauseCommand.enabled = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 播放和暂停（耳机控制）</span></span><br><span class="line">    commandCenter.togglePlayPauseCommand.enabled = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拖拽进度</span></span><br><span class="line">    commandCenter.changePlaybackPositionCommand.enable = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>响应事件处理方法一的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 响应远程事件</span></span><br><span class="line">- (<span class="keyword">void</span>)remoteControlReceivedWithEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.type == <span class="built_in">UIEventTypeRemoteControl</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.subtype) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">UIEventSubtypeRemoteControlPlay</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;RemoteControlEvents: play&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">UIEventSubtypeRemoteControlPause</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;RemoteControlEvents: pause&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">UIEventSubtypeRemoteControlTogglePlayPause</span>:</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;耳机控制：暂停||播放&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">UIEventSubtypeRemoteControlNextTrack</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;RemoteControlEvents: next&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="built_in">UIEventSubtypeRemoteControlPreviousTrack</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@&quot;RemoteControlEvents: previous&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>响应事件处理方法二的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setupCommandCenter &#123;</span><br><span class="line">    <span class="built_in">MPRemoteCommandCenter</span> *commandCenter = [<span class="built_in">MPRemoteCommandCenter</span> sharedCommandCenter];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    [commandCenter.playCommand addTargetWithHandler:^<span class="built_in">MPRemoteCommandHandlerStatus</span>(<span class="built_in">MPRemoteCommandEvent</span> * _Nonnull event) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;play&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">MPRemoteCommandHandlerStatusSuccess</span>;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暂停</span></span><br><span class="line">    [commandCenter.pauseCommand addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handlePauseCommand:)];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拖拽进度</span></span><br><span class="line">    [commandCenter.changePlaybackPositionCommand addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handlePlaybackPositionCommand:)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">MPRemoteCommandHandlerStatus</span>):(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">MPRemoteCommandHandlerStatusSuccess</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">MPRemoteCommandHandlerStatus</span>)handlePlaybackPositionCommand:</span><br><span class="line">(<span class="built_in">MPChangePlaybackPositionCommandEvent</span> *) event</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.palyer seekToTime:<span class="built_in">CMTimeMakeWithSeconds</span>(event.positionTime, <span class="number">1</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;changePlaybackPosition to %f&quot;</span>, event.positionTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">MPRemoteCommandHandlerStatusSuccess</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>不添加<code>beginReceivingRemoteControlEvents</code>时，是否会显示通知栏，是否影响两种方法处理<br>响应事件处理方法二的响应会走两次<br>自定义播放的进度和通知栏的进度不一致</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1e9cb9ec9967">iOS音乐后台播放、锁屏封面及播放控制</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/mediaplayer/mpnowplayinginfocenter">MPNowPlayingInfoCenter</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uiresponder/1621118-remotecontrolreceived">remoteControlReceived(with:)</a></li>
<li><a target="_blank" rel="noopener" href="https://guiyongdong.github.io/2019/07/19/%E3%80%90%E8%BD%AC%E3%80%91AVAudioSession-Category%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/">AVAudioSession-Category各种姿势</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1458459">TXLiteAVSDK中使用 AVAudioSession 问题总结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/eaf5f5e9de19">iOS - AVAudioSession</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://morganwang.cn">今是昨非</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://morganwang.cn/2021/12/30/iOS%20%E7%B1%BB%E4%BC%BC%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%81%E5%B1%8F%E5%B0%81%E9%9D%A2%E6%98%BE%E7%A4%BA/">http://morganwang.cn/2021/12/30/iOS%20%E7%B1%BB%E4%BC%BC%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%81%E5%B1%8F%E5%B0%81%E9%9D%A2%E6%98%BE%E7%A4%BA/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://morganwang.cn" target="_blank">今是昨非的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF/">技术</a><a class="post-meta__tags" href="/tags/iOS/">iOS</a></div><div class="post-share"><div class="social-share" data-image="/assets/img/avatar.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2021/12/30/iOS%20%E5%BD%95%E9%9F%B3%20&amp;&amp;%20%E6%92%AD%E6%94%BE%E5%AE%9E%E7%8E%B0/" title="iOS 录音 &amp;&amp; 播放实现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">iOS 录音 && 播放实现</div></div><div class="info-2"><div class="info-item-1">录音代码录音转 mp3录音播放播放播放锁屏通知栏显示背景问题获取录音时长的问题参考iOS 获取音频时长的正确姿势 笔记，获取音频时长，有两个问题：  录音的 http 链接经过了一次封装，且需要 token 才能获取，这种情况下获取不到 录音的链接，下载保存到系统的 cache 文件夹下  1234567891011121314- (NSTimeInterval)audioDurationFromURL:(NSString *)url &#123;    AVURLAsset *audioAsset = nil;    NSDictionary *dic = @&#123;AVURLAssetPreferPreciseDurationAndTimingKey:@(YES)&#125;;    if ([url hasPrefix:@&quot;http://&quot;]) &#123;        audioAsset = [AVURLAsset URLAssetWithURL:[NSURL URLWithString:url] options:dic];    &#125;...</div></div></div></a><a class="pagination-related  no-desc" href="/2021/12/29/webview%20%E6%8E%A5%E5%85%A5%20HTTPDNS/" title="iOS webview 接入 HTTPDNS"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">iOS webview 接入 HTTPDNS</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2021/05/12/iOS%20mach-o%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E5%A4%9A%E4%BD%99%E7%9A%84%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95/" title="iOS mach-o文件分析多余的类和方法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-12</div><div class="info-item-2">iOS mach-o文件分析多余的类和方法</div></div><div class="info-2"><div class="info-item-1">mach-o文件分析多余的类和方法.md背景最近做包大小优化，在做项目代码优化时，其中有一个过程是分析Mach-O文件，看网上很多文章都说通过otool分析Mach-O，获取__objc_classrefs、__objc_classlist等，然后找出无用类和无用方法。   比如：无用类通过 otool 逆向Mach-O文件 __DATA.__objc_classlist段和__DATA.__objc_classrefs 段获取所有 OC 类和被引用的类，两个集合差值为无用类集合，结合 nm -nm 得到地址和对应类名符号化无用类类名来自干货！京东商城iOS App瘦身实践 又或者结合LinkMap文件的__TEXT.__text，通过正则表达式([+|-][.+\s(.+)])，我们可以提取当前可执行文件里所有objc类方法和实例方法（SelectorsAll）。再使用otool命令otool -v -s __DATA __objc_selrefs逆向__DATA.__objc_selrefs段，提取可执行文件里引用到的方法名（UsedSelectorsAll），我们可以大致分...</div></div></div></a><a class="pagination-related" href="/2024/08/17/SwiftUINavigaiton%E7%94%A8%E6%B3%95/" title="SwiftUI中navigationDestination用法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-17</div><div class="info-item-2">SwiftUI中navigationDestination用法</div></div><div class="info-2"><div class="info-item-1">背景最近做 SwiftUI 项目，之前对于 navigationDestination 的用法理解不太深刻，觉得很是难用，最近发现了正确的使用方式，这里记录一下。   场景假设有一个 TabView 类为 A，A 有 B、C 两个Tab，C 的 Tab 下子界面有 D，D 的子界面有 E。 即有 A -&gt; B 和 A -&gt; C -&gt; D -&gt; E 两条链路。 之前的用法是: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556struct A: View &#123;    var body: some View &#123;        NavigationStack &#123;            TabView(selection: $selectedTab) &#123;                B()                C()            &#125;     ...</div></div></div></a><a class="pagination-related" href="/2024/03/13/Xcode%2015.3%20Archive%E5%A4%B1%E8%B4%A5/" title="Xcode 15.3 Archive失败"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-13</div><div class="info-item-2">Xcode 15.3 Archive失败</div></div><div class="info-2"><div class="info-item-1">Xcode 15.3 Archive失败背景昨晚升级 Xcode 到 15.3，今天打包的时候发现 Archive 失败，提示：Call parameter type does not match function signature!，仔细看报错里是和HandyJSON相关的提示。   解决起初以为和 Pod 库有关系，但是找同事确认后，发现低于 Xcode 15.3 的版本是可以打包成功的，但是 Xcode 15.3 的版本就报错了。然后搜索HandyJSON Call parameter type does not match function signature!，发现了这个，Building HandyJSON in Swift 5.10 throws a fatal error ，是Swift 5.10 编译 HandyJSON报错了。目前HandyJSON官方还未解决。 暂时的解决方法是： 在 Pod 的 Target 中找到 HandyJSON, 然后设置Optimization Level为 None和No Optimization，如下图：  然后再次尝试 A...</div></div></div></a><a class="pagination-related" href="/2022/09/05/%E4%BE%9D%E8%B5%96MapManagerSDK%E5%B4%A9%E6%BA%83%E8%AE%B0%E5%BD%95/" title="MapManagerSDK集成记录"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-05</div><div class="info-item-2">MapManagerSDK集成记录</div></div><div class="info-2"><div class="info-item-1">背景最近集成MapManagerSDK，遇到了几个问题这里记录一下： 问题一： 对接文档中提示的导入GMObjC算法SDK方式如下，导入后编译不通过，提示：&quot;sm2_plaintext_size&quot; Too many arguments to function call, expected 3, have 4   pod &#39;GMObjC&#39;,&#39;3.0.0&#39; 问题二： 导入MapManager后，QMUI库或者其他第三方库，原本正常的，现在报错编译不通过。 问题三： 上面都解决了，编译成功，一启动就崩溃。 解决：问题一&quot;sm2_plaintext_size&quot; Too many arguments to function call, expected 3, have 4的解决很简单，改为pod &#39;GMObjC&#39;，安装最新版即可。 问题二，查看后，发现报错的地方是属性或者方法中使用了debug或者release定义变量。但是为什么之前没有问题，导入MapManagerSDK后，就报错了呢？仔细排查后发现...</div></div></div></a><a class="pagination-related" href="/2021/11/22/%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E7%9A%84%E6%8E%92%E6%9F%A5/" title="上传图片失败问题的排查记录"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-22</div><div class="info-item-2">上传图片失败问题的排查记录</div></div><div class="info-2"><div class="info-item-1">背景最近开发水印相机，遇到了个难缠的问题。这里记录分享一下。 之前上传图片功能的开发，一般都是修改用户头像之类的，所以印象中上传图片，没有什么难处理的，使用 AFNetworking的 formData 进行上传，直接就可以了。但是这次用户大批量使用水印相机后大量反馈上传慢、上传不成功的问题。   排查用户反馈有问题后，开始排查；在用户反馈上传不成功的同一时间，在开发环境和线上环境尝试拍摄上传均可正常上传。 网络问题初步判断是网络问题，由于用户需要在工地现场使用此功能，所以猜测是用户网络环境的问题。建议用户尝试切换网络重新上传。同时让用户使用 SpeedTest.cn测速，发现部分用户月底流量限速网速被限制了，上传网速很低，导致上传不成功。 安全组策略限制然而还是有部分用户，测速显示上传速度28M/s，但是上传依旧超时失败。继续排查后，有同事在测试环境出现了一直上传失败的情况，排查后发现安全组有策略：同一IP单位时间访问请求的数量超出几千次后，当前 IP 会被限制，任何操作都会限制。但是进一步排查后，发现线上因为这个原因被限制的用户并没有太多。 客户端超时继续排查后，发现有用户反...</div></div></div></a><a class="pagination-related" href="/2025/09/25/Xcode%2026%E6%8E%A5%E5%85%A5QWen/" title="Xcode 26 接入QWen"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-25</div><div class="info-item-2">Xcode 26 接入QWen</div></div><div class="info-2"><div class="info-item-1">第一步，注册阿里云百炼账号首先需要一个阿里云百炼的账号，打开后，切换到API参考，按照上面获取API Key的步骤，操作开通，并获取到API Key。   第二步，添加Provider到Xcode 26然后打开Xcode 26，打开设置，选中”Intelligence”，点击添加，如下图  然后会进入输入信息界面，共有4个信息需要输入，URL、API Key、API Key Header、Description，如下图：  URL：https://dashscope.aliyuncs.com/compatible-mode/API Key：==Bear 你自己的APIKey==API KeyHeader: ==Authorization==Description: 这个名字自己定义 这里需要注意的是，如果按照阿里云百炼上提示的，URL配置为 https://dashscope.aliyuncs.com/compatible-mode/v1，点击Save的时候就保存不了，所以需要去掉v1。  点击Save之后，能看到自己开通的所有Models列表，说明成功，如下图。  第三步，使用...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">今是昨非</div><div class="author-info-description">技术分享、生活感悟</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">190</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mokong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/mokong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://x.com/morgan2015_wang" target="_blank" title="Twitter"><i class="fab fa-X"></i></a><a class="social-icon" href="mailto:mokong.2015.1992@email.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%AD%E6%94%BE%E9%94%81%E5%B1%8F%E9%80%9A%E7%9F%A5%E6%A0%8F%E6%98%BE%E7%A4%BA"><span class="toc-number">1.</span> <span class="toc-text">播放锁屏通知栏显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number"></span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number"></span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E5%90%8E%E5%8F%B0%E6%92%AD%E6%94%BE"><span class="toc-number">1.</span> <span class="toc-text">支持后台播放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E5%B1%8F%E9%80%9A%E7%9F%A5%E6%A0%8F%E6%98%BE%E7%A4%BA"><span class="toc-number">2.</span> <span class="toc-text">锁屏通知栏显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number"></span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number"></span> <span class="toc-text">参考</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/27/CodeBuddyCN%20%E4%BD%BF%E7%94%A8%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%83%E7%89%9B%20Model%20%E6%AD%A5%E9%AA%A4/" title="Untitled">Untitled</a><time datetime="2026-01-27T11:49:00.000Z" title="发表于 2026-01-27 19:49:00">2026-01-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/Google%20Antigravity%20%E7%99%BB%E5%BD%95%E4%B8%8D%E4%BA%86%E8%A7%A3%E5%86%B3/" title="Google Antigravity 登录不了解决">Google Antigravity 登录不了解决</a><time datetime="2026-01-22T02:38:00.000Z" title="发表于 2026-01-22 10:38:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具">连夜开发了一个 Mac 上久坐提醒工具</a><time datetime="2026-01-21T13:45:00.000Z" title="发表于 2026-01-21 21:45:00">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/20/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发">关于 AI 与开发</a><time datetime="2026-01-20T11:41:00.000Z" title="发表于 2026-01-20 19:41:00">2026-01-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/16/%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E8%A1%A8%E6%83%85%E5%8C%85/" title="制作自己表情包">制作自己表情包</a><time datetime="2026-01-16T02:21:00.000Z" title="发表于 2026-01-16 10:21:00">2026-01-16</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By 今是昨非</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div><div class="footer_custom_text"><span>日出江花红胜火，春来江水绿如蓝，能不忆江南</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>