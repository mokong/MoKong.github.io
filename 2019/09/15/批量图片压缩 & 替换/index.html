<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>批量图片压缩 &amp; 替换 | 今是昨非的博客</title><meta name="author" content="今是昨非"><meta name="copyright" content="今是昨非"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="批量图片压缩 &amp; 替换背景最近产品提了个需求，要求把包压缩一下，而项目是OC&amp;Swift混编，这期还加上了RN，还要包不能增大。脑壳疼。。。。他则不上天呢。但需求出来了，还是要做的。所以就想了下面几个方法：">
<meta property="og:type" content="article">
<meta property="og:title" content="批量图片压缩 &amp; 替换">
<meta property="og:url" content="http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&%20%E6%9B%BF%E6%8D%A2/index.html">
<meta property="og:site_name" content="今是昨非的博客">
<meta property="og:description" content="批量图片压缩 &amp; 替换背景最近产品提了个需求，要求把包压缩一下，而项目是OC&amp;Swift混编，这期还加上了RN，还要包不能增大。脑壳疼。。。。他则不上天呢。但需求出来了，还是要做的。所以就想了下面几个方法：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://morganwang.cn/assets/img/avatar.jpeg">
<meta property="article:published_time" content="2019-09-14T16:00:00.000Z">
<meta property="article:modified_time" content="2024-01-22T11:04:42.000Z">
<meta property="article:author" content="今是昨非">
<meta property="article:tag" content="技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://morganwang.cn/assets/img/avatar.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "批量图片压缩 & 替换",
  "url": "http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&%20%E6%9B%BF%E6%8D%A2/",
  "image": "http://morganwang.cn/assets/img/avatar.jpeg",
  "datePublished": "2019-09-14T16:00:00.000Z",
  "dateModified": "2024-01-22T11:04:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "今是昨非",
      "url": "http://morganwang.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&amp;%20%E6%9B%BF%E6%8D%A2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '批量图片压缩 & 替换',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">189</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">今是昨非的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">批量图片压缩 &amp; 替换</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">批量图片压缩 &amp; 替换</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-09-14T16:00:00.000Z" title="发表于 2019-09-15 00:00:00">2019-09-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T11:04:42.000Z" title="更新于 2024-01-22 19:04:42">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="批量图片压缩-amp-替换"><a href="#批量图片压缩-amp-替换" class="headerlink" title="批量图片压缩 &amp; 替换"></a>批量图片压缩 &amp; 替换</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近产品提了个需求，要求把包压缩一下，而项目是OC&amp;Swift混编，这期还加上了RN，还要包不能增大。脑壳疼。。。。他则不上天呢。但需求出来了，还是要做的。所以就想了下面几个方法：</p>
<span id="more"></span>

<ol>
<li>先用<a target="_blank" rel="noopener" href="https://github.com/tinymind/LSUnusedResources">LSUnusedResources</a>分析项目中无用的图片和类，删除；</li>
<li>然后对项目中的图片进行压缩替换；</li>
<li>再接着分析<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32003262/find-size-contributed-by-each-external-library-on-ios">linkMap</a>文件，找出大的文件进行优化。</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fishmai/article/details/81603088">基于clang插件的一种iOS包大小瘦身方案</a></li>
</ol>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>这篇就是关于第二步的，项目里大约有1600多张图片，之前几次压缩都是按大小排序，然后把大于10kb的图片一个个上传到<a target="_blank" rel="noopener" href="https://tinypng.com/">tinypng</a>上压缩，再下载替换。tinypng web最多支持一次20张，每次上传压缩，然后等，就问问烦不烦。。。。</p>
<h3 id="图片批量压缩"><a href="#图片批量压缩" class="headerlink" title="图片批量压缩"></a>图片批量压缩</h3><p>so，这次我终于受不了，我要找批量压缩的，还真给我搜到了<a target="_blank" rel="noopener" href="https://github.com/GcsSloop/TinyPng">图片批量压缩脚本(Python)</a>，这种使用方式GitHub上已经写得很清楚了，每月可以500张批量压缩，然后有一个输出文件夹：</p>
<p>使用这个脚本的时候，要注意：</p>
<ol>
<li>安装Python</li>
<li>安装click和tinify</li>
<li>到此处申请 API key: <a target="_blank" rel="noopener" href="https://tinypng.com/developers">https://tinypng.com/developers</a> ，一个 key 每个月可以免费压缩500张图片，可以申请多个 key。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install click // 安装click库</span><br><span class="line">pip install --upgrade tinify // 安装tinify库</span><br></pre></td></tr></table></figure>

<p>然后使用脚本，GitHub里那位大佬脚本print函数没更新，贴一下我更新后的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> tinify</span><br><span class="line"></span><br><span class="line">tinify.key = <span class="string">&quot;Your API Key&quot;</span>		<span class="comment"># API KEY</span></span><br><span class="line">version = <span class="string">&quot;1.0.1&quot;</span>				<span class="comment"># 版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩的核心</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_core</span>(<span class="params">inputFile, outputFile, img_width</span>):</span></span><br><span class="line">	source = tinify.from_file(inputFile)</span><br><span class="line">	<span class="keyword">if</span> img_width <span class="keyword">is</span> <span class="keyword">not</span> -<span class="number">1</span>:</span><br><span class="line">		resized = source.resize(method = <span class="string">&quot;scale&quot;</span>, width  = img_width)</span><br><span class="line">		resized.to_file(outputFile)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		source.to_file(outputFile)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩一个文件夹下的图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_path</span>(<span class="params">path, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_path-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(path):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件夹，请输入文件夹的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		fromFilePath = path 			<span class="comment"># 源路径</span></span><br><span class="line">		toFilePath = path+<span class="string">&quot;/tiny&quot;</span> 		<span class="comment"># 输出路径</span></span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;fromFilePath=%s&quot;</span> %fromFilePath)</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;toFilePath=%s&quot;</span> %toFilePath)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(fromFilePath):</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;root = %s&quot;</span> %root)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;dirs = %s&quot;</span> %dirs)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;files= %s&quot;</span> %files)</span><br><span class="line">			<span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">				fileName, fileSuffix = os.path.splitext(name)</span><br><span class="line">				<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">					toFullPath = toFilePath + root[<span class="built_in">len</span>(fromFilePath):]</span><br><span class="line">					toFullName = toFullPath + <span class="string">&#x27;/&#x27;</span> + name</span><br><span class="line">					<span class="keyword">if</span> os.path.isdir(toFullPath):</span><br><span class="line">						<span class="keyword">pass</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						os.mkdir(toFullPath)</span><br><span class="line">					compress_core(root + <span class="string">&#x27;/&#x27;</span> + name, toFullName, width)</span><br><span class="line">			<span class="keyword">break</span>									<span class="comment"># 仅遍历当前目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅压缩指定文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_file</span>(<span class="params">inputFile, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_file-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(inputFile):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件，请输入文件的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;file = %s&quot;</span> %inputFile)</span><br><span class="line">	dirname  = os.path.dirname(inputFile)</span><br><span class="line">	basename = os.path.basename(inputFile)</span><br><span class="line">	fileName, fileSuffix = os.path.splitext(basename)</span><br><span class="line">	<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">		compress_core(inputFile, dirname+<span class="string">&quot;/tiny_&quot;</span>+basename, width)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;不支持该文件类型!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-f&#x27;</span>, <span class="string">&quot;--file&quot;</span>,  <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;单个文件压缩&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-d&#x27;</span>, <span class="string">&quot;--dir&quot;</span>,   <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;被压缩的文件夹&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;--width&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>,  default=-<span class="number">1</span>,    <span class="built_in">help</span>=<span class="string">&quot;图片宽度，默认不变&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">file, <span class="built_in">dir</span>, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;GcsSloop TinyPng V%s&quot;</span> %(version))</span><br><span class="line">	<span class="keyword">if</span> file <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_file(file, width)				<span class="comment"># 仅压缩一个文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">dir</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_path(<span class="built_in">dir</span>, width)				<span class="comment"># 压缩指定目录下的文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		compress_path(os.getcwd(), width)		<span class="comment"># 压缩当前目录下的文件</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;结束!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="图片批量替换"><a href="#图片批量替换" class="headerlink" title="图片批量替换"></a>图片批量替换</h3><p>Yeah，使用了这个脚本之后，图片可以批量压缩了，但是压缩之后的图片是生成在一个独立文件夹，我需要批量替换，but，我图片的目录不确定，换句话说，我不知道这些文件具体在哪个目录下面。。。。oh no。</p>
<p>so，这是你逼我的，开动脑壳，我就想能不能做到我在读取图片压缩的之后直接替换；又或者，写一个单独的批量替换的脚本，因为大的目录确定，压缩前后图片名字没有变化，这么做应该可行，说干就干<br>使用的时候，把Python文件里TargetPath改成要替换的总目录，SourcePath改成上个脚本执行后压缩后图片的目录，然后运行，binggo，done<br>原理：</p>
<ol>
<li>读取指定目录&amp;子目录下所有文件</li>
<li>判断是不是图片，是就存到数组里</li>
<li>读取Target目录和Source目录，然后遍历用’/‘分割，取最后一个，判断是否相等，相等就写入</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否是图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_img</span>(<span class="params">ext</span>):</span></span><br><span class="line">    ext = ext.lower()</span><br><span class="line">    <span class="keyword">if</span> ext <span class="keyword">in</span> [<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">TargetPath = <span class="string">&#x27;Your Target Path&#x27;</span> <span class="comment"># 要拷贝到哪个目录</span></span><br><span class="line">SourcePath = <span class="string">&#x27;Your Source Path&#x27;</span> <span class="comment"># 从哪个目录拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定目录下所有图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_img_files</span>(<span class="params"><span class="built_in">dir</span></span>):</span></span><br><span class="line">    py_files = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="built_in">dir</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            pre, suf = os.path.splitext(file)</span><br><span class="line">            <span class="keyword">if</span> is_img(suf):</span><br><span class="line">                py_files.append(os.path.join(root, file))</span><br><span class="line">    <span class="keyword">return</span> py_files</span><br><span class="line"></span><br><span class="line">TargetFiles = get_img_files(TargetPath)</span><br><span class="line">SourceFiles = get_img_files(SourcePath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> target <span class="keyword">in</span> TargetFiles:</span><br><span class="line">    <span class="keyword">for</span> source <span class="keyword">in</span> SourceFiles:</span><br><span class="line">        targetName = target.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        sourceName = source.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> targetName == sourceName:</span><br><span class="line">            shutil.copyfile(source, target)</span><br><span class="line">图片批量压缩 &amp; 替换，二合一</span><br><span class="line">这样通过两个脚本就可以实现批量压缩、替换，but，我要跑两个脚本，好麻烦，能不能合二为一，就问你能不能？</span><br><span class="line">小样，这怎么可能难倒机智的我，</span><br><span class="line"></span><br><span class="line">压缩脚本的输出目录是替换脚本的源目录，压缩脚本的源目录是替换脚本的输出目录</span><br><span class="line">所以改一下压缩脚本的实现，读取目录改成是固定的，再改一下压缩脚本的输出目录，注意跟读取目录不要再是读取的子目录，要不然会有问题</span><br><span class="line">然后在压缩脚本执行成功后，执行批量替换脚本，done</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> tinify</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">tinify.key = <span class="string">&quot;Your API KEY&quot;</span>		<span class="comment"># API KEY</span></span><br><span class="line">version = <span class="string">&quot;1.0.1&quot;</span>				<span class="comment"># 版本</span></span><br><span class="line"></span><br><span class="line">TargetPath = <span class="string">&#x27;Your Target Path&#x27;</span> <span class="comment"># 要拷贝到哪个目录</span></span><br><span class="line">SourcePath = <span class="string">&#x27;Your Source Path&#x27;</span> <span class="comment"># 从哪个目录拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩的核心</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_core</span>(<span class="params">inputFile, outputFile, img_width</span>):</span></span><br><span class="line">	source = tinify.from_file(inputFile)</span><br><span class="line">	<span class="keyword">if</span> img_width <span class="keyword">is</span> <span class="keyword">not</span> -<span class="number">1</span>:</span><br><span class="line">		resized = source.resize(method = <span class="string">&quot;scale&quot;</span>, width  = img_width)</span><br><span class="line">		resized.to_file(outputFile)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		source.to_file(outputFile)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩一个文件夹下的图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_path</span>(<span class="params">path, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_path-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(path):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件夹，请输入文件夹的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		fromFilePath = path 			<span class="comment"># 源路径</span></span><br><span class="line">		toFilePath = SourcePath 		<span class="comment"># 输出路径</span></span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;fromFilePath=%s&quot;</span> %fromFilePath)</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;toFilePath=%s&quot;</span> %toFilePath)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(fromFilePath):</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;root = %s&quot;</span> %root)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;dirs = %s&quot;</span> %dirs)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;files= %s&quot;</span> %files)</span><br><span class="line">			<span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">				fileName, fileSuffix = os.path.splitext(name)</span><br><span class="line">				<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">					toFullPath = toFilePath + root[<span class="built_in">len</span>(fromFilePath):]</span><br><span class="line">					toFullName = toFullPath + <span class="string">&#x27;/&#x27;</span> + name</span><br><span class="line">					<span class="keyword">if</span> os.path.isdir(toFullPath):</span><br><span class="line">						<span class="keyword">pass</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						os.mkdir(toFullPath)</span><br><span class="line">					compress_core(root + <span class="string">&#x27;/&#x27;</span> + name, toFullName, width)</span><br><span class="line">			<span class="comment"># break									# 仅遍历当前目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅压缩指定文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_file</span>(<span class="params">inputFile, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_file-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(inputFile):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件，请输入文件的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;file = %s&quot;</span> %inputFile)</span><br><span class="line">	dirname  = os.path.dirname(inputFile)</span><br><span class="line">	basename = os.path.basename(inputFile)</span><br><span class="line">	fileName, fileSuffix = os.path.splitext(basename)</span><br><span class="line">	<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">		compress_core(inputFile, dirname+<span class="string">&quot;/tiny_&quot;</span>+basename, width)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;不支持该文件类型!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否是图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_img</span>(<span class="params">ext</span>):</span></span><br><span class="line">    ext = ext.lower()</span><br><span class="line">    <span class="keyword">if</span> ext <span class="keyword">in</span> [<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定目录下所有图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_img_files</span>(<span class="params"><span class="built_in">dir</span></span>):</span></span><br><span class="line">    py_files = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="built_in">dir</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            pre, suf = os.path.splitext(file)</span><br><span class="line">            <span class="keyword">if</span> is_img(suf):</span><br><span class="line">                py_files.append(os.path.join(root, file))</span><br><span class="line">    <span class="keyword">return</span> py_files</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批处理替换</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_replace_img</span>():</span></span><br><span class="line">    TargetFiles = get_img_files(TargetPath)</span><br><span class="line">    SourceFiles = get_img_files(SourcePath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> target <span class="keyword">in</span> TargetFiles:</span><br><span class="line">        <span class="keyword">for</span> source <span class="keyword">in</span> SourceFiles:</span><br><span class="line">            targetName = target.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            sourceName = source.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> targetName == sourceName:</span><br><span class="line">                shutil.copyfile(source, target)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-f&#x27;</span>, <span class="string">&quot;--file&quot;</span>,  <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;单个文件压缩&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-d&#x27;</span>, <span class="string">&quot;--dir&quot;</span>,   <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;被压缩的文件夹&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;--width&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>,  default=-<span class="number">1</span>,    <span class="built_in">help</span>=<span class="string">&quot;图片宽度，默认不变&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">file, <span class="built_in">dir</span>, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;GcsSloop TinyPng V%s&quot;</span> %(version))</span><br><span class="line">	<span class="keyword">if</span> file <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_file(file, width)				<span class="comment"># 仅压缩一个文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">dir</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_path(<span class="built_in">dir</span>, width)				<span class="comment"># 压缩指定目录下的文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		compress_path(os.getcwd(), width)		<span class="comment"># 压缩当前目录下的文件</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;压缩结束!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># run(None, TargetPath, None)</span></span><br><span class="line">    compress_path(TargetPath, -<span class="number">1</span>)</span><br><span class="line">    batch_replace_img()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;替换结束&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h3><p>but，因为我的工程目录下有1600多张的图片，而批量压缩脚本每月最多执行500张，而且我读取图片又不固定，所以没有办法一次性压缩。so，我还要想我这个能不能一步到位</p>
<p>有没有批量压缩不限数量的API<br>如果没有的话，怎么保证我多次执行这个脚本的连续性，即：我执行了一次之后，下一次换个key，怎么接着执行<br>。。。想想就脑壳疼<br>….to be continued</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://morganwang.cn">今是昨非</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&amp;%20%E6%9B%BF%E6%8D%A2/">http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&amp;%20%E6%9B%BF%E6%8D%A2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://morganwang.cn" target="_blank">今是昨非的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF/">技术</a></div><div class="post-share"><div class="social-share" data-image="/assets/img/avatar.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2019/09/28/Embedded%20binary%20is%20not%20signed%20with%20the%20same%20certificate%20as%20the%20parent%20app/" title="Embedded binary is not signed with the same certificate as the parent app"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Embedded binary is not signed with the same certificate as the parent app</div></div><div class="info-2"><div class="info-item-1">Embedded binary is not signed with the same certificate as the parent app背景Xcode 10之后New Build System变为默认，编译之后一直报错，报错信息：Embedded binary is not signed with the same certificate as the parent app. Verify the embedded binary target’s code sign settings match the parent app’s.   eg:  但是在Legacy Build System下就没有问题。刚开始直接粗暴的改回Legacy Build System，一直没来得及查具体原因，最近得空了，仔细查了一下。 过程搜到的好多人说，是因为keyChain里证书的信任状态不对，要用系统默认，不能强制始终信任。but，我检查了之后，我的证书确实是系统默认的状态。 在stackoverflow上iOS error “Embedded binary is not signed ...</div></div></div></a><a class="pagination-related" href="/2019/09/08/CocoaPods%E7%A7%81%E6%9C%89%E5%BA%93%E7%94%9F%E6%88%90/" title="CocoaPods私有库生成"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">CocoaPods私有库生成</div></div><div class="info-2"><div class="info-item-1">CocoaPods私有库生成</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/07/31/iOS%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Swift 面试题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-31</div><div class="info-item-2">Swift 面试题</div></div><div class="info-2"><div class="info-item-1">背景被问到的面试题，这里记录一下。   问题Swift 中 Struct 和 Class 的区别Swift 中 为什么 String、Array、Dictionary 用 Struct 实现Swift 中写时复制的原理Swift 中变量作用域有哪些，区别是什么Swift中 Protocol 如何声明可空MVP 的优点是什么RxSwift 中冷信号和热信号的区别RxSwift 中 CombineLatest、zip、merge的区别Git 中 rebase和 merge 的区别，rebased的 commitID 会改变吗SwiftUI 中 View 传值方式有哪些什么情况下触发 layoutSubviews 答案Swift 中 Struct 和 Class 的区别Struct是值类型，Class 是引用类型；Struct和 Class 都可以有属性和方法，但是 let 修饰的 Struct 不能更改，Class 修饰的可以更改；Struct方法中修改属性需要在方法前添加 mutating 关键字。Struct和 Class 都可以实现协议。Struct不能被继承，Class 可以...</div></div></div></a><a class="pagination-related" href="/2020/07/12/iOS%2014%E9%80%82%E9%85%8D%E2%80%94%E2%80%94%E6%9F%A5%E6%89%BE%E5%93%AA%E4%BA%9BSDK%E4%BD%BF%E7%94%A8%E5%89%AA%E5%88%87%E6%9D%BF/" title="iOS14适配一查找哪些SDK使用剪切板"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-12</div><div class="info-item-2">iOS14适配一查找哪些SDK使用剪切板</div></div><div class="info-2"><div class="info-item-1">iOS14适配一查找哪些SDK使用剪切板背景iOS14公测版发出之后，我们app出现了从后台唤起会弹出 读取剪切板的 提示，安全要求要赶紧查，全局搜索了我们APP，发现并没有读取剪切板的代码，比窦娥还冤，只能是第三方SDK的问题了，但是项目里集成了十几个第三方SDK，一个个排查删除，万一两个SDK都有，这个排列组合可能性就太多了。   脑壳疼了好几天，求助万能的V友和群友，然后找到了好的办法  步骤1: 用Xcode的Symbolic breakpoint，调试[UIPasteboard generalPasteboard]，按照重现步骤，例如，我们APP是从后台唤起来会有这个提示，就打断点，然后走这个流程。     步骤2: 断点会停在调用到这个方法的地方，然后上下查看，如果还不能确认是哪个SDK的话，就单步向下走几步，然后就会出现调用方     步骤3:具体调用的类已经暴露了之后，怎么确定这是哪个SDK的呢？在工程目录中使用命令（来自群友的帮助）：12find . -type f | grep -e &quot;.framework&quot; | xargs grep -s...</div></div></div></a><a class="pagination-related" href="/2021/04/21/iOS%20%E5%88%A0%E9%99%A4SceneDelegate%E5%92%8CStoryboard/" title="iOS 删除新创建项目中的SceneDelegate"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-21</div><div class="info-item-2">iOS 删除新创建项目中的SceneDelegate</div></div><div class="info-2"><div class="info-item-1">iOS 删除新创建项目中的SceneDelegate背景Xcode 11之后新建工程，默认为有SceneDelegate，但是SceneDelegate是从iOS 13之后才有的，如果最低兼容版本到iOS 13以下，需要怎么做呢？   过程首先来看一下，SceneDelegate是什么，为什么会有SceneDelegate 官方说明：  A UISceneSession object manages a unique runtime instance of your scene. When the user adds a new scene to your app, or when you request one programmatically, the system creates a session object to track that scene. The session contains a unique identifier and the configuration details of the scene. UIKit maintains the sessio...</div></div></div></a><a class="pagination-related" href="/2025/08/21/%E6%88%91%E7%94%A8CodeBuddy%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%E8%AE%B0%E8%B4%A6APP/" title="关于我用CodeBuddy开发了几个APP的体验"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">关于我用CodeBuddy开发了几个APP的体验</div></div><div class="info-2"><div class="info-item-1">背景一直想写，但是太忙了，用CodeBuddy新开发iOSAPP，又同时想做鸿蒙APP，好家伙，是真的忙不过来。   先说体验：我觉得CodeBuddy是最厉害的，（在座的谁赞成，谁反对），🤪，就这么说吧，我用过Trae，Cursor, Windsurf，还申请了Kiro，综合下来，我觉得目前CodeBuddy对于我来说是最厉害的。 我最早用的是Trae，一开始国际版我就用了，使用期间开发了一个app吧，用着用着就智障了，就是本来好好沟通着，突然就感觉对方变傻了，还把项目修改坏了，辛辛苦苦干了好几天，一下子回到解放前了……如果是用量达标，我倒是宁可他提醒我用量达标，也不希望换成一个傻子，就像你跟一个人聊得正投缘，觉得是知己，突然间她流着口水变成了傻子，这换谁也接受不了啊🤣 噢噢，忘了说背景，我是用这些工具做app开发，从头开始开发。所以上面的体验仅供参考。 优点先说优点：  开发快速，只需要说一句话，就能快速搭建一个APP的框架，实现基本功能。 不依赖语言，通过类似的工具，模糊了开发语言的鸿沟，不必说必须学会了某个开发语言，才能开发某种APP或网站，初步能实现”任何人只要有想...</div></div></div></a><a class="pagination-related" href="/2022/04/15/Algorithem_TwoPointers/" title="Algorithem_TwoPointers"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-15</div><div class="info-item-2">Algorithem_TwoPointers</div></div><div class="info-2"><div class="info-item-1">Algorithem_TwoPointersTwo Sum II - Input Array Is SortedGiven a 1-indexed array of integers numbers that is already sorted in non-decreasing order, find two numbers such that they add up to a specific target number. Let these two numbers be numbers[index1] and numbers[index2] where 1 &lt;= index1 &lt; index2 &lt;= numbers.length. Return the indices of the two numbers, index1 and index2, added by one as an integer array [index1, index2] of length 2. The tests are generated such that there is e...</div></div></div></a><a class="pagination-related" href="/2016/01/07/lib(a)%E5%AF%BC%E8%87%B4%E7%9A%84duplicate-symbol%E7%9A%84%E9%97%AE%E9%A2%98/" title="lib(a)导致的duplicate-symbol的问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2016-01-07</div><div class="info-item-2">lib(a)导致的duplicate-symbol的问题</div></div><div class="info-2"><div class="info-item-1">lib(a)导致的duplicate-symbol的问题链接：  iOS lib(.a)库冲突解决办法 iOS 两个静态库存在同名文件冲突解决方案 说明  首先你要确定是这个类型的错误 然后开始，可以按照第一个链接进行修改，也可以看下面  在引入第三方lib(.a)库时，经常会由于第三方lib库中又引入同你现有工程相同的开源代码而造成.o冲突  依次查看lib库所支持的框架类型。i386：模拟器；armv7：iphone4；armv7s：iphone5,iphone5s；arm64：iphone6,iphone6p。  首先，将冲突的那个.a文件单独拷贝到一个文件夹，然后用命令行进入到那个文件夹  查看lib库支持的框架类型，注意下面的lib.a或者libRyFitLibrary.a是我出错的.a文件   12admin-imac:testlib admin$ lipo -info lib.a 2 Architectures in the fat file: lib.a are: armv7armv7s arm64 3 admin-imac:testlib admin$   fa...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">今是昨非</div><div class="author-info-description">技术分享、生活感悟</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">189</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mokong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/mokong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://x.com/morgan2015_wang" target="_blank" title="Twitter"><i class="fab fa-X"></i></a><a class="social-icon" href="mailto:mokong.2015.1992@email.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9-amp-%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.</span> <span class="toc-text">批量图片压缩 &amp; 替换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.3.</span> <span class="toc-text">图片批量压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.4.</span> <span class="toc-text">图片批量替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%85%E7%BB%AD"><span class="toc-number">1.5.</span> <span class="toc-text">待续</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/Google%20Antigravity%20%E7%99%BB%E5%BD%95%E4%B8%8D%E4%BA%86%E8%A7%A3%E5%86%B3/" title="Google Antigravity 登录不了解决">Google Antigravity 登录不了解决</a><time datetime="2026-01-22T02:38:00.000Z" title="发表于 2026-01-22 10:38:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具">连夜开发了一个 Mac 上久坐提醒工具</a><time datetime="2026-01-21T13:45:00.000Z" title="发表于 2026-01-21 21:45:00">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/20/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发">关于 AI 与开发</a><time datetime="2026-01-20T11:41:00.000Z" title="发表于 2026-01-20 19:41:00">2026-01-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/16/%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E8%A1%A8%E6%83%85%E5%8C%85/" title="制作自己表情包">制作自己表情包</a><time datetime="2026-01-16T02:21:00.000Z" title="发表于 2026-01-16 10:21:00">2026-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/13/%E9%B8%BF%E8%92%99%E6%88%AA%E5%9B%BE%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7/" title="鸿蒙截图生成工具">鸿蒙截图生成工具</a><time datetime="2025-10-13T07:24:00.000Z" title="发表于 2025-10-13 15:24:00">2025-10-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By 今是昨非</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div><div class="footer_custom_text"><span>日出江花红胜火，春来江水绿如蓝，能不忆江南</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>