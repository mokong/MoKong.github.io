<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>批量图片压缩 &amp; 替换 | 今是昨非的博客</title><meta name="author" content="今是昨非"><meta name="copyright" content="今是昨非"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="批量图片压缩 &amp; 替换背景最近产品提了个需求，要求把包压缩一下，而项目是OC&amp;Swift混编，这期还加上了RN，还要包不能增大。脑壳疼。。。。他则不上天呢。但需求出来了，还是要做的。所以就想了下面几个方法：">
<meta property="og:type" content="article">
<meta property="og:title" content="批量图片压缩 &amp; 替换">
<meta property="og:url" content="http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&%20%E6%9B%BF%E6%8D%A2/index.html">
<meta property="og:site_name" content="今是昨非的博客">
<meta property="og:description" content="批量图片压缩 &amp; 替换背景最近产品提了个需求，要求把包压缩一下，而项目是OC&amp;Swift混编，这期还加上了RN，还要包不能增大。脑壳疼。。。。他则不上天呢。但需求出来了，还是要做的。所以就想了下面几个方法：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://morganwang.cn/assets/img/avatar.jpeg">
<meta property="article:published_time" content="2019-09-14T16:00:00.000Z">
<meta property="article:modified_time" content="2024-01-22T11:04:42.000Z">
<meta property="article:author" content="今是昨非">
<meta property="article:tag" content="技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://morganwang.cn/assets/img/avatar.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "批量图片压缩 & 替换",
  "url": "http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&%20%E6%9B%BF%E6%8D%A2/",
  "image": "http://morganwang.cn/assets/img/avatar.jpeg",
  "datePublished": "2019-09-14T16:00:00.000Z",
  "dateModified": "2024-01-22T11:04:42.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "今是昨非",
      "url": "http://morganwang.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&amp;%20%E6%9B%BF%E6%8D%A2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '批量图片压缩 & 替换',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">190</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">今是昨非的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">批量图片压缩 &amp; 替换</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">批量图片压缩 &amp; 替换</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-09-14T16:00:00.000Z" title="发表于 2019-09-15 00:00:00">2019-09-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T11:04:42.000Z" title="更新于 2024-01-22 19:04:42">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="批量图片压缩-amp-替换"><a href="#批量图片压缩-amp-替换" class="headerlink" title="批量图片压缩 &amp; 替换"></a>批量图片压缩 &amp; 替换</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近产品提了个需求，要求把包压缩一下，而项目是OC&amp;Swift混编，这期还加上了RN，还要包不能增大。脑壳疼。。。。他则不上天呢。但需求出来了，还是要做的。所以就想了下面几个方法：</p>
<span id="more"></span>

<ol>
<li>先用<a target="_blank" rel="noopener" href="https://github.com/tinymind/LSUnusedResources">LSUnusedResources</a>分析项目中无用的图片和类，删除；</li>
<li>然后对项目中的图片进行压缩替换；</li>
<li>再接着分析<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32003262/find-size-contributed-by-each-external-library-on-ios">linkMap</a>文件，找出大的文件进行优化。</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fishmai/article/details/81603088">基于clang插件的一种iOS包大小瘦身方案</a></li>
</ol>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>这篇就是关于第二步的，项目里大约有1600多张图片，之前几次压缩都是按大小排序，然后把大于10kb的图片一个个上传到<a target="_blank" rel="noopener" href="https://tinypng.com/">tinypng</a>上压缩，再下载替换。tinypng web最多支持一次20张，每次上传压缩，然后等，就问问烦不烦。。。。</p>
<h3 id="图片批量压缩"><a href="#图片批量压缩" class="headerlink" title="图片批量压缩"></a>图片批量压缩</h3><p>so，这次我终于受不了，我要找批量压缩的，还真给我搜到了<a target="_blank" rel="noopener" href="https://github.com/GcsSloop/TinyPng">图片批量压缩脚本(Python)</a>，这种使用方式GitHub上已经写得很清楚了，每月可以500张批量压缩，然后有一个输出文件夹：</p>
<p>使用这个脚本的时候，要注意：</p>
<ol>
<li>安装Python</li>
<li>安装click和tinify</li>
<li>到此处申请 API key: <a target="_blank" rel="noopener" href="https://tinypng.com/developers">https://tinypng.com/developers</a> ，一个 key 每个月可以免费压缩500张图片，可以申请多个 key。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install click // 安装click库</span><br><span class="line">pip install --upgrade tinify // 安装tinify库</span><br></pre></td></tr></table></figure>

<p>然后使用脚本，GitHub里那位大佬脚本print函数没更新，贴一下我更新后的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> tinify</span><br><span class="line"></span><br><span class="line">tinify.key = <span class="string">&quot;Your API Key&quot;</span>		<span class="comment"># API KEY</span></span><br><span class="line">version = <span class="string">&quot;1.0.1&quot;</span>				<span class="comment"># 版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩的核心</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_core</span>(<span class="params">inputFile, outputFile, img_width</span>):</span></span><br><span class="line">	source = tinify.from_file(inputFile)</span><br><span class="line">	<span class="keyword">if</span> img_width <span class="keyword">is</span> <span class="keyword">not</span> -<span class="number">1</span>:</span><br><span class="line">		resized = source.resize(method = <span class="string">&quot;scale&quot;</span>, width  = img_width)</span><br><span class="line">		resized.to_file(outputFile)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		source.to_file(outputFile)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩一个文件夹下的图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_path</span>(<span class="params">path, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_path-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(path):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件夹，请输入文件夹的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		fromFilePath = path 			<span class="comment"># 源路径</span></span><br><span class="line">		toFilePath = path+<span class="string">&quot;/tiny&quot;</span> 		<span class="comment"># 输出路径</span></span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;fromFilePath=%s&quot;</span> %fromFilePath)</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;toFilePath=%s&quot;</span> %toFilePath)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(fromFilePath):</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;root = %s&quot;</span> %root)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;dirs = %s&quot;</span> %dirs)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;files= %s&quot;</span> %files)</span><br><span class="line">			<span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">				fileName, fileSuffix = os.path.splitext(name)</span><br><span class="line">				<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">					toFullPath = toFilePath + root[<span class="built_in">len</span>(fromFilePath):]</span><br><span class="line">					toFullName = toFullPath + <span class="string">&#x27;/&#x27;</span> + name</span><br><span class="line">					<span class="keyword">if</span> os.path.isdir(toFullPath):</span><br><span class="line">						<span class="keyword">pass</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						os.mkdir(toFullPath)</span><br><span class="line">					compress_core(root + <span class="string">&#x27;/&#x27;</span> + name, toFullName, width)</span><br><span class="line">			<span class="keyword">break</span>									<span class="comment"># 仅遍历当前目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅压缩指定文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_file</span>(<span class="params">inputFile, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_file-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(inputFile):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件，请输入文件的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;file = %s&quot;</span> %inputFile)</span><br><span class="line">	dirname  = os.path.dirname(inputFile)</span><br><span class="line">	basename = os.path.basename(inputFile)</span><br><span class="line">	fileName, fileSuffix = os.path.splitext(basename)</span><br><span class="line">	<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">		compress_core(inputFile, dirname+<span class="string">&quot;/tiny_&quot;</span>+basename, width)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;不支持该文件类型!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-f&#x27;</span>, <span class="string">&quot;--file&quot;</span>,  <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;单个文件压缩&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-d&#x27;</span>, <span class="string">&quot;--dir&quot;</span>,   <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;被压缩的文件夹&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;--width&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>,  default=-<span class="number">1</span>,    <span class="built_in">help</span>=<span class="string">&quot;图片宽度，默认不变&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">file, <span class="built_in">dir</span>, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;GcsSloop TinyPng V%s&quot;</span> %(version))</span><br><span class="line">	<span class="keyword">if</span> file <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_file(file, width)				<span class="comment"># 仅压缩一个文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">dir</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_path(<span class="built_in">dir</span>, width)				<span class="comment"># 压缩指定目录下的文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		compress_path(os.getcwd(), width)		<span class="comment"># 压缩当前目录下的文件</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;结束!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="图片批量替换"><a href="#图片批量替换" class="headerlink" title="图片批量替换"></a>图片批量替换</h3><p>Yeah，使用了这个脚本之后，图片可以批量压缩了，但是压缩之后的图片是生成在一个独立文件夹，我需要批量替换，but，我图片的目录不确定，换句话说，我不知道这些文件具体在哪个目录下面。。。。oh no。</p>
<p>so，这是你逼我的，开动脑壳，我就想能不能做到我在读取图片压缩的之后直接替换；又或者，写一个单独的批量替换的脚本，因为大的目录确定，压缩前后图片名字没有变化，这么做应该可行，说干就干<br>使用的时候，把Python文件里TargetPath改成要替换的总目录，SourcePath改成上个脚本执行后压缩后图片的目录，然后运行，binggo，done<br>原理：</p>
<ol>
<li>读取指定目录&amp;子目录下所有文件</li>
<li>判断是不是图片，是就存到数组里</li>
<li>读取Target目录和Source目录，然后遍历用’/‘分割，取最后一个，判断是否相等，相等就写入</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否是图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_img</span>(<span class="params">ext</span>):</span></span><br><span class="line">    ext = ext.lower()</span><br><span class="line">    <span class="keyword">if</span> ext <span class="keyword">in</span> [<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">TargetPath = <span class="string">&#x27;Your Target Path&#x27;</span> <span class="comment"># 要拷贝到哪个目录</span></span><br><span class="line">SourcePath = <span class="string">&#x27;Your Source Path&#x27;</span> <span class="comment"># 从哪个目录拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定目录下所有图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_img_files</span>(<span class="params"><span class="built_in">dir</span></span>):</span></span><br><span class="line">    py_files = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="built_in">dir</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            pre, suf = os.path.splitext(file)</span><br><span class="line">            <span class="keyword">if</span> is_img(suf):</span><br><span class="line">                py_files.append(os.path.join(root, file))</span><br><span class="line">    <span class="keyword">return</span> py_files</span><br><span class="line"></span><br><span class="line">TargetFiles = get_img_files(TargetPath)</span><br><span class="line">SourceFiles = get_img_files(SourcePath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> target <span class="keyword">in</span> TargetFiles:</span><br><span class="line">    <span class="keyword">for</span> source <span class="keyword">in</span> SourceFiles:</span><br><span class="line">        targetName = target.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        sourceName = source.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> targetName == sourceName:</span><br><span class="line">            shutil.copyfile(source, target)</span><br><span class="line">图片批量压缩 &amp; 替换，二合一</span><br><span class="line">这样通过两个脚本就可以实现批量压缩、替换，but，我要跑两个脚本，好麻烦，能不能合二为一，就问你能不能？</span><br><span class="line">小样，这怎么可能难倒机智的我，</span><br><span class="line"></span><br><span class="line">压缩脚本的输出目录是替换脚本的源目录，压缩脚本的源目录是替换脚本的输出目录</span><br><span class="line">所以改一下压缩脚本的实现，读取目录改成是固定的，再改一下压缩脚本的输出目录，注意跟读取目录不要再是读取的子目录，要不然会有问题</span><br><span class="line">然后在压缩脚本执行成功后，执行批量替换脚本，done</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">import</span> tinify</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">tinify.key = <span class="string">&quot;Your API KEY&quot;</span>		<span class="comment"># API KEY</span></span><br><span class="line">version = <span class="string">&quot;1.0.1&quot;</span>				<span class="comment"># 版本</span></span><br><span class="line"></span><br><span class="line">TargetPath = <span class="string">&#x27;Your Target Path&#x27;</span> <span class="comment"># 要拷贝到哪个目录</span></span><br><span class="line">SourcePath = <span class="string">&#x27;Your Source Path&#x27;</span> <span class="comment"># 从哪个目录拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩的核心</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_core</span>(<span class="params">inputFile, outputFile, img_width</span>):</span></span><br><span class="line">	source = tinify.from_file(inputFile)</span><br><span class="line">	<span class="keyword">if</span> img_width <span class="keyword">is</span> <span class="keyword">not</span> -<span class="number">1</span>:</span><br><span class="line">		resized = source.resize(method = <span class="string">&quot;scale&quot;</span>, width  = img_width)</span><br><span class="line">		resized.to_file(outputFile)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		source.to_file(outputFile)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩一个文件夹下的图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_path</span>(<span class="params">path, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_path-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(path):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件夹，请输入文件夹的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		fromFilePath = path 			<span class="comment"># 源路径</span></span><br><span class="line">		toFilePath = SourcePath 		<span class="comment"># 输出路径</span></span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;fromFilePath=%s&quot;</span> %fromFilePath)</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;toFilePath=%s&quot;</span> %toFilePath)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(fromFilePath):</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;root = %s&quot;</span> %root)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;dirs = %s&quot;</span> %dirs)</span><br><span class="line">			<span class="built_in">print</span> (<span class="string">&quot;files= %s&quot;</span> %files)</span><br><span class="line">			<span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">				fileName, fileSuffix = os.path.splitext(name)</span><br><span class="line">				<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">					toFullPath = toFilePath + root[<span class="built_in">len</span>(fromFilePath):]</span><br><span class="line">					toFullName = toFullPath + <span class="string">&#x27;/&#x27;</span> + name</span><br><span class="line">					<span class="keyword">if</span> os.path.isdir(toFullPath):</span><br><span class="line">						<span class="keyword">pass</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						os.mkdir(toFullPath)</span><br><span class="line">					compress_core(root + <span class="string">&#x27;/&#x27;</span> + name, toFullName, width)</span><br><span class="line">			<span class="comment"># break									# 仅遍历当前目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅压缩指定文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compress_file</span>(<span class="params">inputFile, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;compress_file-------------------------------------&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(inputFile):</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;这不是一个文件，请输入文件的正确路径!&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;file = %s&quot;</span> %inputFile)</span><br><span class="line">	dirname  = os.path.dirname(inputFile)</span><br><span class="line">	basename = os.path.basename(inputFile)</span><br><span class="line">	fileName, fileSuffix = os.path.splitext(basename)</span><br><span class="line">	<span class="keyword">if</span> fileSuffix == <span class="string">&#x27;.png&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpg&#x27;</span> <span class="keyword">or</span> fileSuffix == <span class="string">&#x27;.jpeg&#x27;</span>:</span><br><span class="line">		compress_core(inputFile, dirname+<span class="string">&quot;/tiny_&quot;</span>+basename, width)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span> (<span class="string">&quot;不支持该文件类型!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否是图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_img</span>(<span class="params">ext</span>):</span></span><br><span class="line">    ext = ext.lower()</span><br><span class="line">    <span class="keyword">if</span> ext <span class="keyword">in</span> [<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.bmp&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定目录下所有图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_img_files</span>(<span class="params"><span class="built_in">dir</span></span>):</span></span><br><span class="line">    py_files = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="built_in">dir</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            pre, suf = os.path.splitext(file)</span><br><span class="line">            <span class="keyword">if</span> is_img(suf):</span><br><span class="line">                py_files.append(os.path.join(root, file))</span><br><span class="line">    <span class="keyword">return</span> py_files</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批处理替换</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_replace_img</span>():</span></span><br><span class="line">    TargetFiles = get_img_files(TargetPath)</span><br><span class="line">    SourceFiles = get_img_files(SourcePath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> target <span class="keyword">in</span> TargetFiles:</span><br><span class="line">        <span class="keyword">for</span> source <span class="keyword">in</span> SourceFiles:</span><br><span class="line">            targetName = target.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            sourceName = source.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> targetName == sourceName:</span><br><span class="line">                shutil.copyfile(source, target)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-f&#x27;</span>, <span class="string">&quot;--file&quot;</span>,  <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;单个文件压缩&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-d&#x27;</span>, <span class="string">&quot;--dir&quot;</span>,   <span class="built_in">type</span>=<span class="built_in">str</span>,  default=<span class="literal">None</span>,  <span class="built_in">help</span>=<span class="string">&quot;被压缩的文件夹&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-w&#x27;</span>, <span class="string">&quot;--width&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>,  default=-<span class="number">1</span>,    <span class="built_in">help</span>=<span class="string">&quot;图片宽度，默认不变&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">file, <span class="built_in">dir</span>, width</span>):</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;GcsSloop TinyPng V%s&quot;</span> %(version))</span><br><span class="line">	<span class="keyword">if</span> file <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_file(file, width)				<span class="comment"># 仅压缩一个文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">dir</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		compress_path(<span class="built_in">dir</span>, width)				<span class="comment"># 压缩指定目录下的文件</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		compress_path(os.getcwd(), width)		<span class="comment"># 压缩当前目录下的文件</span></span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&quot;压缩结束!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># run(None, TargetPath, None)</span></span><br><span class="line">    compress_path(TargetPath, -<span class="number">1</span>)</span><br><span class="line">    batch_replace_img()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;替换结束&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h3><p>but，因为我的工程目录下有1600多张的图片，而批量压缩脚本每月最多执行500张，而且我读取图片又不固定，所以没有办法一次性压缩。so，我还要想我这个能不能一步到位</p>
<p>有没有批量压缩不限数量的API<br>如果没有的话，怎么保证我多次执行这个脚本的连续性，即：我执行了一次之后，下一次换个key，怎么接着执行<br>。。。想想就脑壳疼<br>….to be continued</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://morganwang.cn">今是昨非</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&amp;%20%E6%9B%BF%E6%8D%A2/">http://morganwang.cn/2019/09/15/%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%20&amp;%20%E6%9B%BF%E6%8D%A2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://morganwang.cn" target="_blank">今是昨非的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF/">技术</a></div><div class="post-share"><div class="social-share" data-image="/assets/img/avatar.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2019/09/28/Embedded%20binary%20is%20not%20signed%20with%20the%20same%20certificate%20as%20the%20parent%20app/" title="Embedded binary is not signed with the same certificate as the parent app"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Embedded binary is not signed with the same certificate as the parent app</div></div><div class="info-2"><div class="info-item-1">Embedded binary is not signed with the same certificate as the parent app背景Xcode 10之后New Build System变为默认，编译之后一直报错，报错信息：Embedded binary is not signed with the same certificate as the parent app. Verify the embedded binary target’s code sign settings match the parent app’s.   eg:  但是在Legacy Build System下就没有问题。刚开始直接粗暴的改回Legacy Build System，一直没来得及查具体原因，最近得空了，仔细查了一下。 过程搜到的好多人说，是因为keyChain里证书的信任状态不对，要用系统默认，不能强制始终信任。but，我检查了之后，我的证书确实是系统默认的状态。 在stackoverflow上iOS error “Embedded binary is not signed ...</div></div></div></a><a class="pagination-related" href="/2019/09/08/CocoaPods%E7%A7%81%E6%9C%89%E5%BA%93%E7%94%9F%E6%88%90/" title="CocoaPods私有库生成"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">CocoaPods私有库生成</div></div><div class="info-2"><div class="info-item-1">CocoaPods私有库生成</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2021/07/26/Flutter%E5%B8%83%E5%B1%80%E5%9F%BA%E7%A1%80%E2%80%94%E2%80%94Stack/" title="Flutter布局基础——Stack层叠布局"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-26</div><div class="info-item-2">Flutter布局基础——Stack层叠布局</div></div><div class="info-2"><div class="info-item-1">Flutter布局基础——Stack层叠布局层叠布局适用于子视图叠放一起，且位置能够相对于父视图边界确认的情况。   比如，可用于图片上加文字，按钮上加渐变阴影等等。 Stack Widget的子视图要么是positioned，要么是non-positioned。Positioned子视图是指使用Positioned的widget包括起来的子视图，通过设置相对于Stack的top、bottom、left、right属性来确认自身位置，其中至少要有一个不为空。 Stack Widget的大小取决于所有non-positioned的子视图。non-positioned的子视图的位置根据alignment属性确定，(当alignment为left-to-right时，子视图默认从左上角开始；当aligment为right-to-left时，子视图从右上角开始；)。 Stack 基础使用Stack常用属性 Stack常用属性 children：子视图 alignment：子视图的对齐方式 topLeft：顶部左对齐 topCenter：顶部居中对齐 topRight：顶部右对齐 cent...</div></div></div></a><a class="pagination-related" href="/2022/04/15/Algorithem_ReverseWords/" title="Algorithem_ReverseWords"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-15</div><div class="info-item-2">Algorithem_ReverseWords</div></div><div class="info-2"><div class="info-item-1">Algorithem_ReverseWordsReverse Words in a String IIIGiven a string s, reverse the order of characters in each word within a sentence while still preserving whitespace and initial word order.    Example 1: 12Input: s = &quot;Let&#x27;s take LeetCode contest&quot;Output: &quot;s&#x27;teL ekat edoCteeL tsetnoc&quot;  Example 2: 12Input: s = &quot;God Ding&quot;Output: &quot;doG gniD&quot;  解法一逻辑：把字符串根据空格切割成数组，然后遍历数组，对数组中字符串调用 reversed 方法，最后在使用空格join为字符串返回 代码如下： 12345678910111213class Solution &#...</div></div></div></a><a class="pagination-related" href="/2022/09/07/iOS%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4%E4%BC%98%E5%8C%96/" title="iOS 编译时间优化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-07</div><div class="info-item-2">iOS 编译时间优化</div></div><div class="info-2"><div class="info-item-1">背景目前App项目不大，但是清空后重新编译时间需要200多秒，感觉不太合理，所以，就着手排查了一下。 通常的编译时间优化都是分为三个部分  Xcode编译设置的优化 代码或函数编译时间的优化 三方库编译时间的优化  这里就根据上面三个部分来一一排查。   实现Xcode编译设置的优化使用的是Xcode 13.4，网上搜到的，关于Xcode设置New Build System，及Build Settings中设置Debug Information Format的都不需要设置了，默认已经是合理的。至于Optimization Level的设置，设置后，虽然编译速度可以提升，但是对于Debug不友好，所以，这里也不做设置。故而针对这项优化什么都没有处理。 代码或函数编译时间的优化这方面主要是针对Swift，首先把编译耗时的方法显示出来，在Build Settings中Other Swift Flags添加如下设置，意思是显示编译超过200ms的函数或者类型检查超过300ms的函数显示warning，这里200ms是自己设定，可针对项目的真实情况设置： 1234-Xfrontend -w...</div></div></div></a><a class="pagination-related" href="/2024/03/16/APP%20%E9%9A%90%E7%A7%81%E6%B8%85%E5%8D%95%E6%B7%BB%E5%8A%A0/" title="APP 隐私清单添加"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-16</div><div class="info-item-2">APP 隐私清单添加</div></div><div class="info-2"><div class="info-item-1">​# APP 隐私清单添加 背景今天送审 APP，提交审核后，邮箱收到了ITMS-91053: Missing API declaration的提示，查看后，发现是缺少隐私清单的提醒。如下图：   记得年初的时候，曾经看到过苹果发布这个的通知（List of APIs that require declared reasons now available），但是当时没有在意，也不知道如何实现，所以就没有管。现在既然提醒了，就说明强制了需要修改。 网上查阅了之后，发现，只有腾讯的这篇苹果隐私策略：PrivacyInfo.xcprivacy，比较合用，再结合下面的图片，就可以看出用法，和对应 key 的意义。  实现具体使用，选中项目，CMD + N，搜索privacy，然后选择类型App Privacy，输入名称PrivacyInfo.xcprivacy，如下图，选择要添加的Target，然后点击完成。  然后选中PrivacyInfo.xcprivacy，右键选择Open As -&gt; Source Code，如下图：  然后参考腾讯的这篇苹果隐私策略：PrivacyInfo...</div></div></div></a><a class="pagination-related" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-21</div><div class="info-item-2">连夜开发了一个 Mac 上久坐提醒工具</div></div><div class="info-2"><div class="info-item-1">背景看到# Mac 端，定时提醒休息，求安利想到自己也需要一个类似的提醒，所以连夜让AI开发了一个，哈哈哈，附加了喝水和提肛提醒（被指到的要提肛10下）。。。      实现界面如下，目前还在审核中。。。    参考</div></div></div></a><a class="pagination-related" href="/2021/07/16/Flutter%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%20&&%20%E8%BF%90%E8%A1%8C/" title="Flutter环境安装 &amp;&amp; 运行"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-16</div><div class="info-item-2">Flutter环境安装 &amp;&amp; 运行</div></div><div class="info-2"><div class="info-item-1">Flutter环境安装 &amp;&amp; 运行背景Flutter环境配置到运行，问题备忘记录。比如遇到Android sdkmanager tool not found和Running Gradle task &#39;assembleDebug&#39;...   Flutter安装超级精简版通过homebrew直接安装，可能需要外网 brew install flutter 手动，Flutter环境搭建 首先下载Flutter安装包，下载地址：https://flutter.dev/docs/development/tools/sdk/releases?tab=macos  其次，解压已下载文件，把文件放入指定目录中，注意：建议放入可以放入用户根目录下，因为后续需要指定bin文件地址，这个目录最好不会经常变动  然后，配置环境变量  打开terminal，如果是zsh，输入open .zshrc；（如果是bash，则输入open .baseprofile）在文件末尾添加如下代码，其中pwd为刚刚解压的flutter/bin文件地址，   1export PATH=&quo...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/assets/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">今是昨非</div><div class="author-info-description">技术分享、生活感悟</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">190</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mokong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/mokong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://x.com/morgan2015_wang" target="_blank" title="Twitter"><i class="fab fa-X"></i></a><a class="social-icon" href="mailto:mokong.2015.1992@email.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9-amp-%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.</span> <span class="toc-text">批量图片压缩 &amp; 替换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.3.</span> <span class="toc-text">图片批量压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.4.</span> <span class="toc-text">图片批量替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%85%E7%BB%AD"><span class="toc-number">1.5.</span> <span class="toc-text">待续</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/27/CodeBuddyCN%20%E4%BD%BF%E7%94%A8%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%83%E7%89%9B%20Model%20%E6%AD%A5%E9%AA%A4/" title="CodeBuddyCN 使用免费的七牛 Model 步骤">CodeBuddyCN 使用免费的七牛 Model 步骤</a><time datetime="2026-01-27T11:49:00.000Z" title="发表于 2026-01-27 19:49:00">2026-01-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/22/Google%20Antigravity%20%E7%99%BB%E5%BD%95%E4%B8%8D%E4%BA%86%E8%A7%A3%E5%86%B3/" title="Google Antigravity 登录不了解决">Google Antigravity 登录不了解决</a><time datetime="2026-01-22T02:38:00.000Z" title="发表于 2026-01-22 10:38:00">2026-01-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/%E8%BF%9E%E5%A4%9C%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%20Mac%20%E4%B8%8A%E4%B9%85%E5%9D%90%E6%8F%90%E9%86%92%E5%B7%A5%E5%85%B7/" title="连夜开发了一个 Mac 上久坐提醒工具">连夜开发了一个 Mac 上久坐提醒工具</a><time datetime="2026-01-21T13:45:00.000Z" title="发表于 2026-01-21 21:45:00">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/20/%E5%85%B3%E4%BA%8E%20AI%20%E4%B8%8E%E5%BC%80%E5%8F%91/" title="关于 AI 与开发">关于 AI 与开发</a><time datetime="2026-01-20T11:41:00.000Z" title="发表于 2026-01-20 19:41:00">2026-01-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/16/%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E8%A1%A8%E6%83%85%E5%8C%85/" title="制作自己表情包">制作自己表情包</a><time datetime="2026-01-16T02:21:00.000Z" title="发表于 2026-01-16 10:21:00">2026-01-16</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By 今是昨非</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div><div class="footer_custom_text"><span>日出江花红胜火，春来江水绿如蓝，能不忆江南</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      false
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>